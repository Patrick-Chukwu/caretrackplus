{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport { m as mergeProps, g as guid, i as isArraysEqual, T as Theme, a as mapHash, B as BaseComponent, V as ViewContextType, C as ContentContainer, b as buildViewClassNames, c as greatestDurationDenominator, d as createDuration, e as BASE_OPTION_DEFAULTS, f as arrayToHash, h as filterHash, j as buildEventSourceRefiners, p as parseEventSource, k as formatWithOrdinals, u as unpromisify, l as buildRangeApiWithTimeZone, n as identity, r as requestJson, s as subtractDurations, o as intersectRanges, q as startOfDay, t as addDays, v as hashValuesToArray, w as buildEventApis, D as DelayedRunner, x as createFormatter, y as diffWholeDays, z as memoize, A as memoizeObjArg, E as isPropsEqual, F as Emitter, G as getInitialDate, H as rangeContainsMarker, I as createEmptyEventStore, J as reduceCurrentDate, K as reduceEventStore, L as rezoneEventStoreDates, M as mergeRawOptions, N as BASE_OPTION_REFINERS, O as CALENDAR_LISTENER_REFINERS, P as CALENDAR_OPTION_REFINERS, Q as COMPLEX_OPTION_COMPARATORS, R as VIEW_OPTION_REFINERS, S as DateEnv, U as DateProfileGenerator, W as createEventUi, X as parseBusinessHours, Y as setRef, Z as Interaction, _ as getElSeg, $ as elementClosest, a0 as EventImpl, a1 as listenBySelector, a2 as listenToHoverBySelector, a3 as PureComponent, a4 as buildViewContext, a5 as getUniqueDomId, a6 as parseInteractionSettings, a7 as interactionSettingsStore, a8 as getNow, a9 as CalendarImpl, aa as flushSync, ab as CalendarRoot, ac as RenderId, ad as ensureElHasStyles, ae as applyStyleProp, af as sliceEventStore } from './internal-common.js';\nexport { ag as JsonRequestError } from './internal-common.js';\nimport { createElement, createRef, Fragment, render } from 'preact';\nimport 'preact/compat';\nconst globalLocales = [];\nconst MINIMAL_RAW_EN_LOCALE = {\n  code: 'en',\n  week: {\n    dow: 0,\n    doy: 4 // 4 days need to be within the year to be considered the first week\n\n  },\n  direction: 'ltr',\n  buttonText: {\n    prev: 'prev',\n    next: 'next',\n    prevYear: 'prev year',\n    nextYear: 'next year',\n    year: 'year',\n    today: 'today',\n    month: 'month',\n    week: 'week',\n    day: 'day',\n    list: 'list'\n  },\n  weekText: 'W',\n  weekTextLong: 'Week',\n  closeHint: 'Close',\n  timeHint: 'Time',\n  eventHint: 'Event',\n  allDayText: 'all-day',\n  moreLinkText: 'more',\n  noEventsText: 'No events to display'\n};\nconst RAW_EN_LOCALE = Object.assign(Object.assign({}, MINIMAL_RAW_EN_LOCALE), {\n  // Includes things we don't want other locales to inherit,\n  // things that derive from other translatable strings.\n  buttonHints: {\n    prev: 'Previous $0',\n    next: 'Next $0',\n\n    today(buttonText, unit) {\n      return unit === 'day' ? 'Today' : `This ${buttonText}`;\n    }\n\n  },\n  viewHint: '$0 view',\n  navLinkHint: 'Go to $0',\n\n  moreLinkHint(eventCnt) {\n    return `Show ${eventCnt} more event${eventCnt === 1 ? '' : 's'}`;\n  }\n\n});\n\nfunction organizeRawLocales(explicitRawLocales) {\n  let defaultCode = explicitRawLocales.length > 0 ? explicitRawLocales[0].code : 'en';\n  let allRawLocales = globalLocales.concat(explicitRawLocales);\n  let rawLocaleMap = {\n    en: RAW_EN_LOCALE\n  };\n\n  for (let rawLocale of allRawLocales) {\n    rawLocaleMap[rawLocale.code] = rawLocale;\n  }\n\n  return {\n    map: rawLocaleMap,\n    defaultCode\n  };\n}\n\nfunction buildLocale(inputSingular, available) {\n  if (typeof inputSingular === 'object' && !Array.isArray(inputSingular)) {\n    return parseLocale(inputSingular.code, [inputSingular.code], inputSingular);\n  }\n\n  return queryLocale(inputSingular, available);\n}\n\nfunction queryLocale(codeArg, available) {\n  let codes = [].concat(codeArg || []); // will convert to array\n\n  let raw = queryRawLocale(codes, available) || RAW_EN_LOCALE;\n  return parseLocale(codeArg, codes, raw);\n}\n\nfunction queryRawLocale(codes, available) {\n  for (let i = 0; i < codes.length; i += 1) {\n    let parts = codes[i].toLocaleLowerCase().split('-');\n\n    for (let j = parts.length; j > 0; j -= 1) {\n      let simpleId = parts.slice(0, j).join('-');\n\n      if (available[simpleId]) {\n        return available[simpleId];\n      }\n    }\n  }\n\n  return null;\n}\n\nfunction parseLocale(codeArg, codes, raw) {\n  let merged = mergeProps([MINIMAL_RAW_EN_LOCALE, raw], ['buttonText']);\n  delete merged.code; // don't want this part of the options\n\n  let {\n    week\n  } = merged;\n  delete merged.week;\n  return {\n    codeArg,\n    codes,\n    week,\n    simpleNumberFormat: new Intl.NumberFormat(codeArg),\n    options: merged\n  };\n} // TODO: easier way to add new hooks? need to update a million things\n\n\nfunction createPlugin(input) {\n  return {\n    id: guid(),\n    name: input.name,\n    premiumReleaseDate: input.premiumReleaseDate ? new Date(input.premiumReleaseDate) : undefined,\n    deps: input.deps || [],\n    reducers: input.reducers || [],\n    isLoadingFuncs: input.isLoadingFuncs || [],\n    contextInit: [].concat(input.contextInit || []),\n    eventRefiners: input.eventRefiners || {},\n    eventDefMemberAdders: input.eventDefMemberAdders || [],\n    eventSourceRefiners: input.eventSourceRefiners || {},\n    isDraggableTransformers: input.isDraggableTransformers || [],\n    eventDragMutationMassagers: input.eventDragMutationMassagers || [],\n    eventDefMutationAppliers: input.eventDefMutationAppliers || [],\n    dateSelectionTransformers: input.dateSelectionTransformers || [],\n    datePointTransforms: input.datePointTransforms || [],\n    dateSpanTransforms: input.dateSpanTransforms || [],\n    views: input.views || {},\n    viewPropsTransformers: input.viewPropsTransformers || [],\n    isPropsValid: input.isPropsValid || null,\n    externalDefTransforms: input.externalDefTransforms || [],\n    viewContainerAppends: input.viewContainerAppends || [],\n    eventDropTransformers: input.eventDropTransformers || [],\n    componentInteractions: input.componentInteractions || [],\n    calendarInteractions: input.calendarInteractions || [],\n    themeClasses: input.themeClasses || {},\n    eventSourceDefs: input.eventSourceDefs || [],\n    cmdFormatter: input.cmdFormatter,\n    recurringTypes: input.recurringTypes || [],\n    namedTimeZonedImpl: input.namedTimeZonedImpl,\n    initialView: input.initialView || '',\n    elementDraggingImpl: input.elementDraggingImpl,\n    optionChangeHandlers: input.optionChangeHandlers || {},\n    scrollGridImpl: input.scrollGridImpl || null,\n    listenerRefiners: input.listenerRefiners || {},\n    optionRefiners: input.optionRefiners || {},\n    propSetHandlers: input.propSetHandlers || {}\n  };\n}\n\nfunction buildPluginHooks(pluginDefs, globalDefs) {\n  let currentPluginIds = {};\n  let hooks = {\n    premiumReleaseDate: undefined,\n    reducers: [],\n    isLoadingFuncs: [],\n    contextInit: [],\n    eventRefiners: {},\n    eventDefMemberAdders: [],\n    eventSourceRefiners: {},\n    isDraggableTransformers: [],\n    eventDragMutationMassagers: [],\n    eventDefMutationAppliers: [],\n    dateSelectionTransformers: [],\n    datePointTransforms: [],\n    dateSpanTransforms: [],\n    views: {},\n    viewPropsTransformers: [],\n    isPropsValid: null,\n    externalDefTransforms: [],\n    viewContainerAppends: [],\n    eventDropTransformers: [],\n    componentInteractions: [],\n    calendarInteractions: [],\n    themeClasses: {},\n    eventSourceDefs: [],\n    cmdFormatter: null,\n    recurringTypes: [],\n    namedTimeZonedImpl: null,\n    initialView: '',\n    elementDraggingImpl: null,\n    optionChangeHandlers: {},\n    scrollGridImpl: null,\n    listenerRefiners: {},\n    optionRefiners: {},\n    propSetHandlers: {}\n  };\n\n  function addDefs(defs) {\n    for (let def of defs) {\n      const pluginName = def.name;\n      const currentId = currentPluginIds[pluginName];\n\n      if (currentId === undefined) {\n        currentPluginIds[pluginName] = def.id;\n        addDefs(def.deps);\n        hooks = combineHooks(hooks, def);\n      } else if (currentId !== def.id) {\n        // different ID than the one already added\n        console.warn(`Duplicate plugin '${pluginName}'`);\n      }\n    }\n  }\n\n  if (pluginDefs) {\n    addDefs(pluginDefs);\n  }\n\n  addDefs(globalDefs);\n  return hooks;\n}\n\nfunction buildBuildPluginHooks() {\n  let currentOverrideDefs = [];\n  let currentGlobalDefs = [];\n  let currentHooks;\n  return (overrideDefs, globalDefs) => {\n    if (!currentHooks || !isArraysEqual(overrideDefs, currentOverrideDefs) || !isArraysEqual(globalDefs, currentGlobalDefs)) {\n      currentHooks = buildPluginHooks(overrideDefs, globalDefs);\n    }\n\n    currentOverrideDefs = overrideDefs;\n    currentGlobalDefs = globalDefs;\n    return currentHooks;\n  };\n}\n\nfunction combineHooks(hooks0, hooks1) {\n  return {\n    premiumReleaseDate: compareOptionalDates(hooks0.premiumReleaseDate, hooks1.premiumReleaseDate),\n    reducers: hooks0.reducers.concat(hooks1.reducers),\n    isLoadingFuncs: hooks0.isLoadingFuncs.concat(hooks1.isLoadingFuncs),\n    contextInit: hooks0.contextInit.concat(hooks1.contextInit),\n    eventRefiners: Object.assign(Object.assign({}, hooks0.eventRefiners), hooks1.eventRefiners),\n    eventDefMemberAdders: hooks0.eventDefMemberAdders.concat(hooks1.eventDefMemberAdders),\n    eventSourceRefiners: Object.assign(Object.assign({}, hooks0.eventSourceRefiners), hooks1.eventSourceRefiners),\n    isDraggableTransformers: hooks0.isDraggableTransformers.concat(hooks1.isDraggableTransformers),\n    eventDragMutationMassagers: hooks0.eventDragMutationMassagers.concat(hooks1.eventDragMutationMassagers),\n    eventDefMutationAppliers: hooks0.eventDefMutationAppliers.concat(hooks1.eventDefMutationAppliers),\n    dateSelectionTransformers: hooks0.dateSelectionTransformers.concat(hooks1.dateSelectionTransformers),\n    datePointTransforms: hooks0.datePointTransforms.concat(hooks1.datePointTransforms),\n    dateSpanTransforms: hooks0.dateSpanTransforms.concat(hooks1.dateSpanTransforms),\n    views: Object.assign(Object.assign({}, hooks0.views), hooks1.views),\n    viewPropsTransformers: hooks0.viewPropsTransformers.concat(hooks1.viewPropsTransformers),\n    isPropsValid: hooks1.isPropsValid || hooks0.isPropsValid,\n    externalDefTransforms: hooks0.externalDefTransforms.concat(hooks1.externalDefTransforms),\n    viewContainerAppends: hooks0.viewContainerAppends.concat(hooks1.viewContainerAppends),\n    eventDropTransformers: hooks0.eventDropTransformers.concat(hooks1.eventDropTransformers),\n    calendarInteractions: hooks0.calendarInteractions.concat(hooks1.calendarInteractions),\n    componentInteractions: hooks0.componentInteractions.concat(hooks1.componentInteractions),\n    themeClasses: Object.assign(Object.assign({}, hooks0.themeClasses), hooks1.themeClasses),\n    eventSourceDefs: hooks0.eventSourceDefs.concat(hooks1.eventSourceDefs),\n    cmdFormatter: hooks1.cmdFormatter || hooks0.cmdFormatter,\n    recurringTypes: hooks0.recurringTypes.concat(hooks1.recurringTypes),\n    namedTimeZonedImpl: hooks1.namedTimeZonedImpl || hooks0.namedTimeZonedImpl,\n    initialView: hooks0.initialView || hooks1.initialView,\n    elementDraggingImpl: hooks0.elementDraggingImpl || hooks1.elementDraggingImpl,\n    optionChangeHandlers: Object.assign(Object.assign({}, hooks0.optionChangeHandlers), hooks1.optionChangeHandlers),\n    scrollGridImpl: hooks1.scrollGridImpl || hooks0.scrollGridImpl,\n    listenerRefiners: Object.assign(Object.assign({}, hooks0.listenerRefiners), hooks1.listenerRefiners),\n    optionRefiners: Object.assign(Object.assign({}, hooks0.optionRefiners), hooks1.optionRefiners),\n    propSetHandlers: Object.assign(Object.assign({}, hooks0.propSetHandlers), hooks1.propSetHandlers)\n  };\n}\n\nfunction compareOptionalDates(date0, date1) {\n  if (date0 === undefined) {\n    return date1;\n  }\n\n  if (date1 === undefined) {\n    return date0;\n  }\n\n  return new Date(Math.max(date0.valueOf(), date1.valueOf()));\n}\n\nclass StandardTheme extends Theme {}\n\nStandardTheme.prototype.classes = {\n  root: 'fc-theme-standard',\n  tableCellShaded: 'fc-cell-shaded',\n  buttonGroup: 'fc-button-group',\n  button: 'fc-button fc-button-primary',\n  buttonActive: 'fc-button-active'\n};\nStandardTheme.prototype.baseIconClass = 'fc-icon';\nStandardTheme.prototype.iconClasses = {\n  close: 'fc-icon-x',\n  prev: 'fc-icon-chevron-left',\n  next: 'fc-icon-chevron-right',\n  prevYear: 'fc-icon-chevrons-left',\n  nextYear: 'fc-icon-chevrons-right'\n};\nStandardTheme.prototype.rtlIconClasses = {\n  prev: 'fc-icon-chevron-right',\n  next: 'fc-icon-chevron-left',\n  prevYear: 'fc-icon-chevrons-right',\n  nextYear: 'fc-icon-chevrons-left'\n};\nStandardTheme.prototype.iconOverrideOption = 'buttonIcons'; // TODO: make TS-friendly\n\nStandardTheme.prototype.iconOverrideCustomButtonOption = 'icon';\nStandardTheme.prototype.iconOverridePrefix = 'fc-icon-';\n\nfunction compileViewDefs(defaultConfigs, overrideConfigs) {\n  let hash = {};\n  let viewType;\n\n  for (viewType in defaultConfigs) {\n    ensureViewDef(viewType, hash, defaultConfigs, overrideConfigs);\n  }\n\n  for (viewType in overrideConfigs) {\n    ensureViewDef(viewType, hash, defaultConfigs, overrideConfigs);\n  }\n\n  return hash;\n}\n\nfunction ensureViewDef(viewType, hash, defaultConfigs, overrideConfigs) {\n  if (hash[viewType]) {\n    return hash[viewType];\n  }\n\n  let viewDef = buildViewDef(viewType, hash, defaultConfigs, overrideConfigs);\n\n  if (viewDef) {\n    hash[viewType] = viewDef;\n  }\n\n  return viewDef;\n}\n\nfunction buildViewDef(viewType, hash, defaultConfigs, overrideConfigs) {\n  let defaultConfig = defaultConfigs[viewType];\n  let overrideConfig = overrideConfigs[viewType];\n\n  let queryProp = name => defaultConfig && defaultConfig[name] !== null ? defaultConfig[name] : overrideConfig && overrideConfig[name] !== null ? overrideConfig[name] : null;\n\n  let theComponent = queryProp('component');\n  let superType = queryProp('superType');\n  let superDef = null;\n\n  if (superType) {\n    if (superType === viewType) {\n      throw new Error('Can\\'t have a custom view type that references itself');\n    }\n\n    superDef = ensureViewDef(superType, hash, defaultConfigs, overrideConfigs);\n  }\n\n  if (!theComponent && superDef) {\n    theComponent = superDef.component;\n  }\n\n  if (!theComponent) {\n    return null; // don't throw a warning, might be settings for a single-unit view\n  }\n\n  return {\n    type: viewType,\n    component: theComponent,\n    defaults: Object.assign(Object.assign({}, superDef ? superDef.defaults : {}), defaultConfig ? defaultConfig.rawOptions : {}),\n    overrides: Object.assign(Object.assign({}, superDef ? superDef.overrides : {}), overrideConfig ? overrideConfig.rawOptions : {})\n  };\n}\n\nfunction parseViewConfigs(inputs) {\n  return mapHash(inputs, parseViewConfig);\n}\n\nfunction parseViewConfig(input) {\n  let rawOptions = typeof input === 'function' ? {\n    component: input\n  } : input;\n  let {\n    component\n  } = rawOptions;\n\n  if (rawOptions.content) {\n    // TODO: remove content/classNames/didMount/etc from options?\n    component = createViewHookComponent(rawOptions);\n  } else if (component && !(component.prototype instanceof BaseComponent)) {\n    // WHY?: people were using `component` property for `content`\n    // TODO: converge on one setting name\n    component = createViewHookComponent(Object.assign(Object.assign({}, rawOptions), {\n      content: component\n    }));\n  }\n\n  return {\n    superType: rawOptions.type,\n    component: component,\n    rawOptions // includes type and component too :(\n\n  };\n}\n\nfunction createViewHookComponent(options) {\n  return viewProps => createElement(ViewContextType.Consumer, null, context => createElement(ContentContainer, {\n    elTag: \"div\",\n    elClasses: buildViewClassNames(context.viewSpec),\n    renderProps: Object.assign(Object.assign({}, viewProps), {\n      nextDayThreshold: context.options.nextDayThreshold\n    }),\n    generatorName: undefined,\n    customGenerator: options.content,\n    classNameGenerator: options.classNames,\n    didMount: options.didMount,\n    willUnmount: options.willUnmount\n  }));\n}\n\nfunction buildViewSpecs(defaultInputs, optionOverrides, dynamicOptionOverrides, localeDefaults) {\n  let defaultConfigs = parseViewConfigs(defaultInputs);\n  let overrideConfigs = parseViewConfigs(optionOverrides.views);\n  let viewDefs = compileViewDefs(defaultConfigs, overrideConfigs);\n  return mapHash(viewDefs, viewDef => buildViewSpec(viewDef, overrideConfigs, optionOverrides, dynamicOptionOverrides, localeDefaults));\n}\n\nfunction buildViewSpec(viewDef, overrideConfigs, optionOverrides, dynamicOptionOverrides, localeDefaults) {\n  let durationInput = viewDef.overrides.duration || viewDef.defaults.duration || dynamicOptionOverrides.duration || optionOverrides.duration;\n  let duration = null;\n  let durationUnit = '';\n  let singleUnit = '';\n  let singleUnitOverrides = {};\n\n  if (durationInput) {\n    duration = createDurationCached(durationInput);\n\n    if (duration) {\n      // valid?\n      let denom = greatestDurationDenominator(duration);\n      durationUnit = denom.unit;\n\n      if (denom.value === 1) {\n        singleUnit = durationUnit;\n        singleUnitOverrides = overrideConfigs[durationUnit] ? overrideConfigs[durationUnit].rawOptions : {};\n      }\n    }\n  }\n\n  let queryButtonText = optionsSubset => {\n    let buttonTextMap = optionsSubset.buttonText || {};\n    let buttonTextKey = viewDef.defaults.buttonTextKey;\n\n    if (buttonTextKey != null && buttonTextMap[buttonTextKey] != null) {\n      return buttonTextMap[buttonTextKey];\n    }\n\n    if (buttonTextMap[viewDef.type] != null) {\n      return buttonTextMap[viewDef.type];\n    }\n\n    if (buttonTextMap[singleUnit] != null) {\n      return buttonTextMap[singleUnit];\n    }\n\n    return null;\n  };\n\n  let queryButtonTitle = optionsSubset => {\n    let buttonHints = optionsSubset.buttonHints || {};\n    let buttonKey = viewDef.defaults.buttonTextKey; // use same key as text\n\n    if (buttonKey != null && buttonHints[buttonKey] != null) {\n      return buttonHints[buttonKey];\n    }\n\n    if (buttonHints[viewDef.type] != null) {\n      return buttonHints[viewDef.type];\n    }\n\n    if (buttonHints[singleUnit] != null) {\n      return buttonHints[singleUnit];\n    }\n\n    return null;\n  };\n\n  return {\n    type: viewDef.type,\n    component: viewDef.component,\n    duration,\n    durationUnit,\n    singleUnit,\n    optionDefaults: viewDef.defaults,\n    optionOverrides: Object.assign(Object.assign({}, singleUnitOverrides), viewDef.overrides),\n    buttonTextOverride: queryButtonText(dynamicOptionOverrides) || queryButtonText(optionOverrides) || // constructor-specified buttonText lookup hash takes precedence\n    viewDef.overrides.buttonText,\n    buttonTextDefault: queryButtonText(localeDefaults) || viewDef.defaults.buttonText || queryButtonText(BASE_OPTION_DEFAULTS) || viewDef.type,\n    // not DRY\n    buttonTitleOverride: queryButtonTitle(dynamicOptionOverrides) || queryButtonTitle(optionOverrides) || viewDef.overrides.buttonHint,\n    buttonTitleDefault: queryButtonTitle(localeDefaults) || viewDef.defaults.buttonHint || queryButtonTitle(BASE_OPTION_DEFAULTS) // will eventually fall back to buttonText\n\n  };\n} // hack to get memoization working\n\n\nlet durationInputMap = {};\n\nfunction createDurationCached(durationInput) {\n  let json = JSON.stringify(durationInput);\n  let res = durationInputMap[json];\n\n  if (res === undefined) {\n    res = createDuration(durationInput);\n    durationInputMap[json] = res;\n  }\n\n  return res;\n}\n\nfunction reduceViewType(viewType, action) {\n  switch (action.type) {\n    case 'CHANGE_VIEW_TYPE':\n      viewType = action.viewType;\n  }\n\n  return viewType;\n}\n\nfunction reduceDynamicOptionOverrides(dynamicOptionOverrides, action) {\n  switch (action.type) {\n    case 'SET_OPTION':\n      return Object.assign(Object.assign({}, dynamicOptionOverrides), {\n        [action.optionName]: action.rawOptionValue\n      });\n\n    default:\n      return dynamicOptionOverrides;\n  }\n}\n\nfunction reduceDateProfile(currentDateProfile, action, currentDate, dateProfileGenerator) {\n  let dp;\n\n  switch (action.type) {\n    case 'CHANGE_VIEW_TYPE':\n      return dateProfileGenerator.build(action.dateMarker || currentDate);\n\n    case 'CHANGE_DATE':\n      return dateProfileGenerator.build(action.dateMarker);\n\n    case 'PREV':\n      dp = dateProfileGenerator.buildPrev(currentDateProfile, currentDate);\n\n      if (dp.isValid) {\n        return dp;\n      }\n\n      break;\n\n    case 'NEXT':\n      dp = dateProfileGenerator.buildNext(currentDateProfile, currentDate);\n\n      if (dp.isValid) {\n        return dp;\n      }\n\n      break;\n  }\n\n  return currentDateProfile;\n}\n\nfunction initEventSources(calendarOptions, dateProfile, context) {\n  let activeRange = dateProfile ? dateProfile.activeRange : null;\n  return addSources({}, parseInitialSources(calendarOptions, context), activeRange, context);\n}\n\nfunction reduceEventSources(eventSources, action, dateProfile, context) {\n  let activeRange = dateProfile ? dateProfile.activeRange : null; // need this check?\n\n  switch (action.type) {\n    case 'ADD_EVENT_SOURCES':\n      // already parsed\n      return addSources(eventSources, action.sources, activeRange, context);\n\n    case 'REMOVE_EVENT_SOURCE':\n      return removeSource(eventSources, action.sourceId);\n\n    case 'PREV': // TODO: how do we track all actions that affect dateProfile :(\n\n    case 'NEXT':\n    case 'CHANGE_DATE':\n    case 'CHANGE_VIEW_TYPE':\n      if (dateProfile) {\n        return fetchDirtySources(eventSources, activeRange, context);\n      }\n\n      return eventSources;\n\n    case 'FETCH_EVENT_SOURCES':\n      return fetchSourcesByIds(eventSources, action.sourceIds ? // why no type?\n      arrayToHash(action.sourceIds) : excludeStaticSources(eventSources, context), activeRange, action.isRefetch || false, context);\n\n    case 'RECEIVE_EVENTS':\n    case 'RECEIVE_EVENT_ERROR':\n      return receiveResponse(eventSources, action.sourceId, action.fetchId, action.fetchRange);\n\n    case 'REMOVE_ALL_EVENT_SOURCES':\n      return {};\n\n    default:\n      return eventSources;\n  }\n}\n\nfunction reduceEventSourcesNewTimeZone(eventSources, dateProfile, context) {\n  let activeRange = dateProfile ? dateProfile.activeRange : null; // need this check?\n\n  return fetchSourcesByIds(eventSources, excludeStaticSources(eventSources, context), activeRange, true, context);\n}\n\nfunction computeEventSourcesLoading(eventSources) {\n  for (let sourceId in eventSources) {\n    if (eventSources[sourceId].isFetching) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction addSources(eventSourceHash, sources, fetchRange, context) {\n  let hash = {};\n\n  for (let source of sources) {\n    hash[source.sourceId] = source;\n  }\n\n  if (fetchRange) {\n    hash = fetchDirtySources(hash, fetchRange, context);\n  }\n\n  return Object.assign(Object.assign({}, eventSourceHash), hash);\n}\n\nfunction removeSource(eventSourceHash, sourceId) {\n  return filterHash(eventSourceHash, eventSource => eventSource.sourceId !== sourceId);\n}\n\nfunction fetchDirtySources(sourceHash, fetchRange, context) {\n  return fetchSourcesByIds(sourceHash, filterHash(sourceHash, eventSource => isSourceDirty(eventSource, fetchRange, context)), fetchRange, false, context);\n}\n\nfunction isSourceDirty(eventSource, fetchRange, context) {\n  if (!doesSourceNeedRange(eventSource, context)) {\n    return !eventSource.latestFetchId;\n  }\n\n  return !context.options.lazyFetching || !eventSource.fetchRange || eventSource.isFetching || // always cancel outdated in-progress fetches\n  fetchRange.start < eventSource.fetchRange.start || fetchRange.end > eventSource.fetchRange.end;\n}\n\nfunction fetchSourcesByIds(prevSources, sourceIdHash, fetchRange, isRefetch, context) {\n  let nextSources = {};\n\n  for (let sourceId in prevSources) {\n    let source = prevSources[sourceId];\n\n    if (sourceIdHash[sourceId]) {\n      nextSources[sourceId] = fetchSource(source, fetchRange, isRefetch, context);\n    } else {\n      nextSources[sourceId] = source;\n    }\n  }\n\n  return nextSources;\n}\n\nfunction fetchSource(eventSource, fetchRange, isRefetch, context) {\n  let {\n    options,\n    calendarApi\n  } = context;\n  let sourceDef = context.pluginHooks.eventSourceDefs[eventSource.sourceDefId];\n  let fetchId = guid();\n  sourceDef.fetch({\n    eventSource,\n    range: fetchRange,\n    isRefetch,\n    context\n  }, res => {\n    let {\n      rawEvents\n    } = res;\n\n    if (options.eventSourceSuccess) {\n      rawEvents = options.eventSourceSuccess.call(calendarApi, rawEvents, res.response) || rawEvents;\n    }\n\n    if (eventSource.success) {\n      rawEvents = eventSource.success.call(calendarApi, rawEvents, res.response) || rawEvents;\n    }\n\n    context.dispatch({\n      type: 'RECEIVE_EVENTS',\n      sourceId: eventSource.sourceId,\n      fetchId,\n      fetchRange,\n      rawEvents\n    });\n  }, error => {\n    let errorHandled = false;\n\n    if (options.eventSourceFailure) {\n      options.eventSourceFailure.call(calendarApi, error);\n      errorHandled = true;\n    }\n\n    if (eventSource.failure) {\n      eventSource.failure(error);\n      errorHandled = true;\n    }\n\n    if (!errorHandled) {\n      console.warn(error.message, error);\n    }\n\n    context.dispatch({\n      type: 'RECEIVE_EVENT_ERROR',\n      sourceId: eventSource.sourceId,\n      fetchId,\n      fetchRange,\n      error\n    });\n  });\n  return Object.assign(Object.assign({}, eventSource), {\n    isFetching: true,\n    latestFetchId: fetchId\n  });\n}\n\nfunction receiveResponse(sourceHash, sourceId, fetchId, fetchRange) {\n  let eventSource = sourceHash[sourceId];\n\n  if (eventSource && // not already removed\n  fetchId === eventSource.latestFetchId) {\n    return Object.assign(Object.assign({}, sourceHash), {\n      [sourceId]: Object.assign(Object.assign({}, eventSource), {\n        isFetching: false,\n        fetchRange\n      })\n    });\n  }\n\n  return sourceHash;\n}\n\nfunction excludeStaticSources(eventSources, context) {\n  return filterHash(eventSources, eventSource => doesSourceNeedRange(eventSource, context));\n}\n\nfunction parseInitialSources(rawOptions, context) {\n  let refiners = buildEventSourceRefiners(context);\n  let rawSources = [].concat(rawOptions.eventSources || []);\n  let sources = []; // parsed\n\n  if (rawOptions.initialEvents) {\n    rawSources.unshift(rawOptions.initialEvents);\n  }\n\n  if (rawOptions.events) {\n    rawSources.unshift(rawOptions.events);\n  }\n\n  for (let rawSource of rawSources) {\n    let source = parseEventSource(rawSource, context, refiners);\n\n    if (source) {\n      sources.push(source);\n    }\n  }\n\n  return sources;\n}\n\nfunction doesSourceNeedRange(eventSource, context) {\n  let defs = context.pluginHooks.eventSourceDefs;\n  return !defs[eventSource.sourceDefId].ignoreRange;\n}\n\nfunction reduceDateSelection(currentSelection, action) {\n  switch (action.type) {\n    case 'UNSELECT_DATES':\n      return null;\n\n    case 'SELECT_DATES':\n      return action.selection;\n\n    default:\n      return currentSelection;\n  }\n}\n\nfunction reduceSelectedEvent(currentInstanceId, action) {\n  switch (action.type) {\n    case 'UNSELECT_EVENT':\n      return '';\n\n    case 'SELECT_EVENT':\n      return action.eventInstanceId;\n\n    default:\n      return currentInstanceId;\n  }\n}\n\nfunction reduceEventDrag(currentDrag, action) {\n  let newDrag;\n\n  switch (action.type) {\n    case 'UNSET_EVENT_DRAG':\n      return null;\n\n    case 'SET_EVENT_DRAG':\n      newDrag = action.state;\n      return {\n        affectedEvents: newDrag.affectedEvents,\n        mutatedEvents: newDrag.mutatedEvents,\n        isEvent: newDrag.isEvent\n      };\n\n    default:\n      return currentDrag;\n  }\n}\n\nfunction reduceEventResize(currentResize, action) {\n  let newResize;\n\n  switch (action.type) {\n    case 'UNSET_EVENT_RESIZE':\n      return null;\n\n    case 'SET_EVENT_RESIZE':\n      newResize = action.state;\n      return {\n        affectedEvents: newResize.affectedEvents,\n        mutatedEvents: newResize.mutatedEvents,\n        isEvent: newResize.isEvent\n      };\n\n    default:\n      return currentResize;\n  }\n}\n\nfunction parseToolbars(calendarOptions, calendarOptionOverrides, theme, viewSpecs, calendarApi) {\n  let header = calendarOptions.headerToolbar ? parseToolbar(calendarOptions.headerToolbar, calendarOptions, calendarOptionOverrides, theme, viewSpecs, calendarApi) : null;\n  let footer = calendarOptions.footerToolbar ? parseToolbar(calendarOptions.footerToolbar, calendarOptions, calendarOptionOverrides, theme, viewSpecs, calendarApi) : null;\n  return {\n    header,\n    footer\n  };\n}\n\nfunction parseToolbar(sectionStrHash, calendarOptions, calendarOptionOverrides, theme, viewSpecs, calendarApi) {\n  let sectionWidgets = {};\n  let viewsWithButtons = [];\n  let hasTitle = false;\n\n  for (let sectionName in sectionStrHash) {\n    let sectionStr = sectionStrHash[sectionName];\n    let sectionRes = parseSection(sectionStr, calendarOptions, calendarOptionOverrides, theme, viewSpecs, calendarApi);\n    sectionWidgets[sectionName] = sectionRes.widgets;\n    viewsWithButtons.push(...sectionRes.viewsWithButtons);\n    hasTitle = hasTitle || sectionRes.hasTitle;\n  }\n\n  return {\n    sectionWidgets,\n    viewsWithButtons,\n    hasTitle\n  };\n}\n/*\nBAD: querying icons and text here. should be done at render time\n*/\n\n\nfunction parseSection(sectionStr, calendarOptions, // defaults+overrides, then refined\ncalendarOptionOverrides, // overrides only!, unrefined :(\ntheme, viewSpecs, calendarApi) {\n  let isRtl = calendarOptions.direction === 'rtl';\n  let calendarCustomButtons = calendarOptions.customButtons || {};\n  let calendarButtonTextOverrides = calendarOptionOverrides.buttonText || {};\n  let calendarButtonText = calendarOptions.buttonText || {};\n  let calendarButtonHintOverrides = calendarOptionOverrides.buttonHints || {};\n  let calendarButtonHints = calendarOptions.buttonHints || {};\n  let sectionSubstrs = sectionStr ? sectionStr.split(' ') : [];\n  let viewsWithButtons = [];\n  let hasTitle = false;\n  let widgets = sectionSubstrs.map(buttonGroupStr => buttonGroupStr.split(',').map(buttonName => {\n    if (buttonName === 'title') {\n      hasTitle = true;\n      return {\n        buttonName\n      };\n    }\n\n    let customButtonProps;\n    let viewSpec;\n    let buttonClick;\n    let buttonIcon; // only one of these will be set\n\n    let buttonText; // \"\n\n    let buttonHint; // ^ for the title=\"\" attribute, for accessibility\n\n    if (customButtonProps = calendarCustomButtons[buttonName]) {\n      buttonClick = ev => {\n        if (customButtonProps.click) {\n          customButtonProps.click.call(ev.target, ev, ev.target); // TODO: use Calendar this context?\n        }\n      };\n\n      (buttonIcon = theme.getCustomButtonIconClass(customButtonProps)) || (buttonIcon = theme.getIconClass(buttonName, isRtl)) || (buttonText = customButtonProps.text);\n      buttonHint = customButtonProps.hint || customButtonProps.text;\n    } else if (viewSpec = viewSpecs[buttonName]) {\n      viewsWithButtons.push(buttonName);\n\n      buttonClick = () => {\n        calendarApi.changeView(buttonName);\n      };\n\n      (buttonText = viewSpec.buttonTextOverride) || (buttonIcon = theme.getIconClass(buttonName, isRtl)) || (buttonText = viewSpec.buttonTextDefault);\n      let textFallback = viewSpec.buttonTextOverride || viewSpec.buttonTextDefault;\n      buttonHint = formatWithOrdinals(viewSpec.buttonTitleOverride || viewSpec.buttonTitleDefault || calendarOptions.viewHint, [textFallback, buttonName], // view-name = buttonName\n      textFallback);\n    } else if (calendarApi[buttonName]) {\n      // a calendarApi method\n      buttonClick = () => {\n        calendarApi[buttonName]();\n      };\n\n      (buttonText = calendarButtonTextOverrides[buttonName]) || (buttonIcon = theme.getIconClass(buttonName, isRtl)) || (buttonText = calendarButtonText[buttonName]); // everything else is considered default\n\n      if (buttonName === 'prevYear' || buttonName === 'nextYear') {\n        let prevOrNext = buttonName === 'prevYear' ? 'prev' : 'next';\n        buttonHint = formatWithOrdinals(calendarButtonHintOverrides[prevOrNext] || calendarButtonHints[prevOrNext], [calendarButtonText.year || 'year', 'year'], calendarButtonText[buttonName]);\n      } else {\n        buttonHint = navUnit => formatWithOrdinals(calendarButtonHintOverrides[buttonName] || calendarButtonHints[buttonName], [calendarButtonText[navUnit] || navUnit, navUnit], calendarButtonText[buttonName]);\n      }\n    }\n\n    return {\n      buttonName,\n      buttonClick,\n      buttonIcon,\n      buttonText,\n      buttonHint\n    };\n  }));\n  return {\n    widgets,\n    viewsWithButtons,\n    hasTitle\n  };\n} // always represents the current view. otherwise, it'd need to change value every time date changes\n\n\nclass ViewImpl {\n  constructor(type, getCurrentData, dateEnv) {\n    this.type = type;\n    this.getCurrentData = getCurrentData;\n    this.dateEnv = dateEnv;\n  }\n\n  get calendar() {\n    return this.getCurrentData().calendarApi;\n  }\n\n  get title() {\n    return this.getCurrentData().viewTitle;\n  }\n\n  get activeStart() {\n    return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.start);\n  }\n\n  get activeEnd() {\n    return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.end);\n  }\n\n  get currentStart() {\n    return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.start);\n  }\n\n  get currentEnd() {\n    return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.end);\n  }\n\n  getOption(name) {\n    return this.getCurrentData().options[name]; // are the view-specific options\n  }\n\n}\n\nlet eventSourceDef$2 = {\n  ignoreRange: true,\n\n  parseMeta(refined) {\n    if (Array.isArray(refined.events)) {\n      return refined.events;\n    }\n\n    return null;\n  },\n\n  fetch(arg, successCallback) {\n    successCallback({\n      rawEvents: arg.eventSource.meta\n    });\n  }\n\n};\nconst arrayEventSourcePlugin = createPlugin({\n  name: 'array-event-source',\n  eventSourceDefs: [eventSourceDef$2]\n});\nlet eventSourceDef$1 = {\n  parseMeta(refined) {\n    if (typeof refined.events === 'function') {\n      return refined.events;\n    }\n\n    return null;\n  },\n\n  fetch(arg, successCallback, errorCallback) {\n    const {\n      dateEnv\n    } = arg.context;\n    const func = arg.eventSource.meta;\n    unpromisify(func.bind(null, buildRangeApiWithTimeZone(arg.range, dateEnv)), rawEvents => successCallback({\n      rawEvents\n    }), errorCallback);\n  }\n\n};\nconst funcEventSourcePlugin = createPlugin({\n  name: 'func-event-source',\n  eventSourceDefs: [eventSourceDef$1]\n});\nconst JSON_FEED_EVENT_SOURCE_REFINERS = {\n  method: String,\n  extraParams: identity,\n  startParam: String,\n  endParam: String,\n  timeZoneParam: String\n};\nlet eventSourceDef = {\n  parseMeta(refined) {\n    if (refined.url && (refined.format === 'json' || !refined.format)) {\n      return {\n        url: refined.url,\n        format: 'json',\n        method: (refined.method || 'GET').toUpperCase(),\n        extraParams: refined.extraParams,\n        startParam: refined.startParam,\n        endParam: refined.endParam,\n        timeZoneParam: refined.timeZoneParam\n      };\n    }\n\n    return null;\n  },\n\n  fetch(arg, successCallback, errorCallback) {\n    const {\n      meta\n    } = arg.eventSource;\n    const requestParams = buildRequestParams(meta, arg.range, arg.context);\n    requestJson(meta.method, meta.url, requestParams).then(([rawEvents, response]) => {\n      successCallback({\n        rawEvents,\n        response\n      });\n    }, errorCallback);\n  }\n\n};\nconst jsonFeedEventSourcePlugin = createPlugin({\n  name: 'json-event-source',\n  eventSourceRefiners: JSON_FEED_EVENT_SOURCE_REFINERS,\n  eventSourceDefs: [eventSourceDef]\n});\n\nfunction buildRequestParams(meta, range, context) {\n  let {\n    dateEnv,\n    options\n  } = context;\n  let startParam;\n  let endParam;\n  let timeZoneParam;\n  let customRequestParams;\n  let params = {};\n  startParam = meta.startParam;\n\n  if (startParam == null) {\n    startParam = options.startParam;\n  }\n\n  endParam = meta.endParam;\n\n  if (endParam == null) {\n    endParam = options.endParam;\n  }\n\n  timeZoneParam = meta.timeZoneParam;\n\n  if (timeZoneParam == null) {\n    timeZoneParam = options.timeZoneParam;\n  } // retrieve any outbound GET/POST data from the options\n\n\n  if (typeof meta.extraParams === 'function') {\n    // supplied as a function that returns a key/value object\n    customRequestParams = meta.extraParams();\n  } else {\n    // probably supplied as a straight key/value object\n    customRequestParams = meta.extraParams || {};\n  }\n\n  Object.assign(params, customRequestParams);\n  params[startParam] = dateEnv.formatIso(range.start);\n  params[endParam] = dateEnv.formatIso(range.end);\n\n  if (dateEnv.timeZone !== 'local') {\n    params[timeZoneParam] = dateEnv.timeZone;\n  }\n\n  return params;\n}\n\nconst SIMPLE_RECURRING_REFINERS = {\n  daysOfWeek: identity,\n  startTime: createDuration,\n  endTime: createDuration,\n  duration: createDuration,\n  startRecur: identity,\n  endRecur: identity\n};\nlet recurring = {\n  parse(refined, dateEnv) {\n    if (refined.daysOfWeek || refined.startTime || refined.endTime || refined.startRecur || refined.endRecur) {\n      let recurringData = {\n        daysOfWeek: refined.daysOfWeek || null,\n        startTime: refined.startTime || null,\n        endTime: refined.endTime || null,\n        startRecur: refined.startRecur ? dateEnv.createMarker(refined.startRecur) : null,\n        endRecur: refined.endRecur ? dateEnv.createMarker(refined.endRecur) : null\n      };\n      let duration;\n\n      if (refined.duration) {\n        duration = refined.duration;\n      }\n\n      if (!duration && refined.startTime && refined.endTime) {\n        duration = subtractDurations(refined.endTime, refined.startTime);\n      }\n\n      return {\n        allDayGuess: Boolean(!refined.startTime && !refined.endTime),\n        duration,\n        typeData: recurringData // doesn't need endTime anymore but oh well\n\n      };\n    }\n\n    return null;\n  },\n\n  expand(typeData, framingRange, dateEnv) {\n    let clippedFramingRange = intersectRanges(framingRange, {\n      start: typeData.startRecur,\n      end: typeData.endRecur\n    });\n\n    if (clippedFramingRange) {\n      return expandRanges(typeData.daysOfWeek, typeData.startTime, clippedFramingRange, dateEnv);\n    }\n\n    return [];\n  }\n\n};\nconst simpleRecurringEventsPlugin = createPlugin({\n  name: 'simple-recurring-event',\n  recurringTypes: [recurring],\n  eventRefiners: SIMPLE_RECURRING_REFINERS\n});\n\nfunction expandRanges(daysOfWeek, startTime, framingRange, dateEnv) {\n  let dowHash = daysOfWeek ? arrayToHash(daysOfWeek) : null;\n  let dayMarker = startOfDay(framingRange.start);\n  let endMarker = framingRange.end;\n  let instanceStarts = [];\n\n  while (dayMarker < endMarker) {\n    let instanceStart; // if everyday, or this particular day-of-week\n\n    if (!dowHash || dowHash[dayMarker.getUTCDay()]) {\n      if (startTime) {\n        instanceStart = dateEnv.add(dayMarker, startTime);\n      } else {\n        instanceStart = dayMarker;\n      }\n\n      instanceStarts.push(instanceStart);\n    }\n\n    dayMarker = addDays(dayMarker, 1);\n  }\n\n  return instanceStarts;\n}\n\nconst changeHandlerPlugin = createPlugin({\n  name: 'change-handler',\n  optionChangeHandlers: {\n    events(events, context) {\n      handleEventSources([events], context);\n    },\n\n    eventSources: handleEventSources\n  }\n});\n/*\nBUG: if `event` was supplied, all previously-given `eventSources` will be wiped out\n*/\n\nfunction handleEventSources(inputs, context) {\n  let unfoundSources = hashValuesToArray(context.getCurrentData().eventSources);\n\n  if (unfoundSources.length === 1 && inputs.length === 1 && Array.isArray(unfoundSources[0]._raw) && Array.isArray(inputs[0])) {\n    context.dispatch({\n      type: 'RESET_RAW_EVENTS',\n      sourceId: unfoundSources[0].sourceId,\n      rawEvents: inputs[0]\n    });\n    return;\n  }\n\n  let newInputs = [];\n\n  for (let input of inputs) {\n    let inputFound = false;\n\n    for (let i = 0; i < unfoundSources.length; i += 1) {\n      if (unfoundSources[i]._raw === input) {\n        unfoundSources.splice(i, 1); // delete\n\n        inputFound = true;\n        break;\n      }\n    }\n\n    if (!inputFound) {\n      newInputs.push(input);\n    }\n  }\n\n  for (let unfoundSource of unfoundSources) {\n    context.dispatch({\n      type: 'REMOVE_EVENT_SOURCE',\n      sourceId: unfoundSource.sourceId\n    });\n  }\n\n  for (let newInput of newInputs) {\n    context.calendarApi.addEventSource(newInput);\n  }\n}\n\nfunction handleDateProfile(dateProfile, context) {\n  context.emitter.trigger('datesSet', Object.assign(Object.assign({}, buildRangeApiWithTimeZone(dateProfile.activeRange, context.dateEnv)), {\n    view: context.viewApi\n  }));\n}\n\nfunction handleEventStore(eventStore, context) {\n  let {\n    emitter\n  } = context;\n\n  if (emitter.hasHandlers('eventsSet')) {\n    emitter.trigger('eventsSet', buildEventApis(eventStore, context));\n  }\n}\n/*\nthis array is exposed on the root namespace so that UMD plugins can add to it.\nsee the rollup-bundles script.\n*/\n\n\nconst globalPlugins = [arrayEventSourcePlugin, funcEventSourcePlugin, jsonFeedEventSourcePlugin, simpleRecurringEventsPlugin, changeHandlerPlugin, createPlugin({\n  name: 'misc',\n  isLoadingFuncs: [state => computeEventSourcesLoading(state.eventSources)],\n  propSetHandlers: {\n    dateProfile: handleDateProfile,\n    eventStore: handleEventStore\n  }\n})];\n\nclass TaskRunner {\n  constructor(runTaskOption, drainedOption) {\n    this.runTaskOption = runTaskOption;\n    this.drainedOption = drainedOption;\n    this.queue = [];\n    this.delayedRunner = new DelayedRunner(this.drain.bind(this));\n  }\n\n  request(task, delay) {\n    this.queue.push(task);\n    this.delayedRunner.request(delay);\n  }\n\n  pause(scope) {\n    this.delayedRunner.pause(scope);\n  }\n\n  resume(scope, force) {\n    this.delayedRunner.resume(scope, force);\n  }\n\n  drain() {\n    let {\n      queue\n    } = this;\n\n    while (queue.length) {\n      let completedTasks = [];\n      let task;\n\n      while (task = queue.shift()) {\n        this.runTask(task);\n        completedTasks.push(task);\n      }\n\n      this.drained(completedTasks);\n    } // keep going, in case new tasks were added in the drained handler\n\n  }\n\n  runTask(task) {\n    if (this.runTaskOption) {\n      this.runTaskOption(task);\n    }\n  }\n\n  drained(completedTasks) {\n    if (this.drainedOption) {\n      this.drainedOption(completedTasks);\n    }\n  }\n\n} // Computes what the title at the top of the calendarApi should be for this view\n\n\nfunction buildTitle(dateProfile, viewOptions, dateEnv) {\n  let range; // for views that span a large unit of time, show the proper interval, ignoring stray days before and after\n\n  if (/^(year|month)$/.test(dateProfile.currentRangeUnit)) {\n    range = dateProfile.currentRange;\n  } else {\n    // for day units or smaller, use the actual day range\n    range = dateProfile.activeRange;\n  }\n\n  return dateEnv.formatRange(range.start, range.end, createFormatter(viewOptions.titleFormat || buildTitleFormat(dateProfile)), {\n    isEndExclusive: dateProfile.isRangeAllDay,\n    defaultSeparator: viewOptions.titleRangeSeparator\n  });\n} // Generates the format string that should be used to generate the title for the current date range.\n// Attempts to compute the most appropriate format if not explicitly specified with `titleFormat`.\n\n\nfunction buildTitleFormat(dateProfile) {\n  let {\n    currentRangeUnit\n  } = dateProfile;\n\n  if (currentRangeUnit === 'year') {\n    return {\n      year: 'numeric'\n    };\n  }\n\n  if (currentRangeUnit === 'month') {\n    return {\n      year: 'numeric',\n      month: 'long'\n    }; // like \"September 2014\"\n  }\n\n  let days = diffWholeDays(dateProfile.currentRange.start, dateProfile.currentRange.end);\n\n  if (days !== null && days > 1) {\n    // multi-day range. shorter, like \"Sep 9 - 10 2014\"\n    return {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    };\n  } // one day. longer, like \"September 9 2014\"\n\n\n  return {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric'\n  };\n} // in future refactor, do the redux-style function(state=initial) for initial-state\n// also, whatever is happening in constructor, have it happen in action queue too\n\n\nclass CalendarDataManager {\n  constructor(props) {\n    this.computeCurrentViewData = memoize(this._computeCurrentViewData);\n    this.organizeRawLocales = memoize(organizeRawLocales);\n    this.buildLocale = memoize(buildLocale);\n    this.buildPluginHooks = buildBuildPluginHooks();\n    this.buildDateEnv = memoize(buildDateEnv$1);\n    this.buildTheme = memoize(buildTheme);\n    this.parseToolbars = memoize(parseToolbars);\n    this.buildViewSpecs = memoize(buildViewSpecs);\n    this.buildDateProfileGenerator = memoizeObjArg(buildDateProfileGenerator);\n    this.buildViewApi = memoize(buildViewApi);\n    this.buildViewUiProps = memoizeObjArg(buildViewUiProps);\n    this.buildEventUiBySource = memoize(buildEventUiBySource, isPropsEqual);\n    this.buildEventUiBases = memoize(buildEventUiBases);\n    this.parseContextBusinessHours = memoizeObjArg(parseContextBusinessHours);\n    this.buildTitle = memoize(buildTitle);\n    this.emitter = new Emitter();\n    this.actionRunner = new TaskRunner(this._handleAction.bind(this), this.updateData.bind(this));\n    this.currentCalendarOptionsInput = {};\n    this.currentCalendarOptionsRefined = {};\n    this.currentViewOptionsInput = {};\n    this.currentViewOptionsRefined = {};\n    this.currentCalendarOptionsRefiners = {};\n    this.optionsForRefining = [];\n    this.optionsForHandling = [];\n\n    this.getCurrentData = () => this.data;\n\n    this.dispatch = action => {\n      this.actionRunner.request(action); // protects against recursive calls to _handleAction\n    };\n\n    this.props = props;\n    this.actionRunner.pause();\n    let dynamicOptionOverrides = {};\n    let optionsData = this.computeOptionsData(props.optionOverrides, dynamicOptionOverrides, props.calendarApi);\n    let currentViewType = optionsData.calendarOptions.initialView || optionsData.pluginHooks.initialView;\n    let currentViewData = this.computeCurrentViewData(currentViewType, optionsData, props.optionOverrides, dynamicOptionOverrides); // wire things up\n    // TODO: not DRY\n\n    props.calendarApi.currentDataManager = this;\n    this.emitter.setThisContext(props.calendarApi);\n    this.emitter.setOptions(currentViewData.options);\n    let currentDate = getInitialDate(optionsData.calendarOptions, optionsData.dateEnv);\n    let dateProfile = currentViewData.dateProfileGenerator.build(currentDate);\n\n    if (!rangeContainsMarker(dateProfile.activeRange, currentDate)) {\n      currentDate = dateProfile.currentRange.start;\n    }\n\n    let calendarContext = {\n      dateEnv: optionsData.dateEnv,\n      options: optionsData.calendarOptions,\n      pluginHooks: optionsData.pluginHooks,\n      calendarApi: props.calendarApi,\n      dispatch: this.dispatch,\n      emitter: this.emitter,\n      getCurrentData: this.getCurrentData\n    }; // needs to be after setThisContext\n\n    for (let callback of optionsData.pluginHooks.contextInit) {\n      callback(calendarContext);\n    } // NOT DRY\n\n\n    let eventSources = initEventSources(optionsData.calendarOptions, dateProfile, calendarContext);\n    let initialState = {\n      dynamicOptionOverrides,\n      currentViewType,\n      currentDate,\n      dateProfile,\n      businessHours: this.parseContextBusinessHours(calendarContext),\n      eventSources,\n      eventUiBases: {},\n      eventStore: createEmptyEventStore(),\n      renderableEventStore: createEmptyEventStore(),\n      dateSelection: null,\n      eventSelection: '',\n      eventDrag: null,\n      eventResize: null,\n      selectionConfig: this.buildViewUiProps(calendarContext).selectionConfig\n    };\n    let contextAndState = Object.assign(Object.assign({}, calendarContext), initialState);\n\n    for (let reducer of optionsData.pluginHooks.reducers) {\n      Object.assign(initialState, reducer(null, null, contextAndState));\n    }\n\n    if (computeIsLoading(initialState, calendarContext)) {\n      this.emitter.trigger('loading', true); // NOT DRY\n    }\n\n    this.state = initialState;\n    this.updateData();\n    this.actionRunner.resume();\n  }\n\n  resetOptions(optionOverrides, changedOptionNames) {\n    let {\n      props\n    } = this;\n\n    if (changedOptionNames === undefined) {\n      props.optionOverrides = optionOverrides;\n    } else {\n      props.optionOverrides = Object.assign(Object.assign({}, props.optionOverrides || {}), optionOverrides);\n      this.optionsForRefining.push(...changedOptionNames);\n    }\n\n    if (changedOptionNames === undefined || changedOptionNames.length) {\n      this.actionRunner.request({\n        type: 'NOTHING'\n      });\n    }\n  }\n\n  _handleAction(action) {\n    let {\n      props,\n      state,\n      emitter\n    } = this;\n    let dynamicOptionOverrides = reduceDynamicOptionOverrides(state.dynamicOptionOverrides, action);\n    let optionsData = this.computeOptionsData(props.optionOverrides, dynamicOptionOverrides, props.calendarApi);\n    let currentViewType = reduceViewType(state.currentViewType, action);\n    let currentViewData = this.computeCurrentViewData(currentViewType, optionsData, props.optionOverrides, dynamicOptionOverrides); // wire things up\n    // TODO: not DRY\n\n    props.calendarApi.currentDataManager = this;\n    emitter.setThisContext(props.calendarApi);\n    emitter.setOptions(currentViewData.options);\n    let calendarContext = {\n      dateEnv: optionsData.dateEnv,\n      options: optionsData.calendarOptions,\n      pluginHooks: optionsData.pluginHooks,\n      calendarApi: props.calendarApi,\n      dispatch: this.dispatch,\n      emitter,\n      getCurrentData: this.getCurrentData\n    };\n    let {\n      currentDate,\n      dateProfile\n    } = state;\n\n    if (this.data && this.data.dateProfileGenerator !== currentViewData.dateProfileGenerator) {\n      // hack\n      dateProfile = currentViewData.dateProfileGenerator.build(currentDate);\n    }\n\n    currentDate = reduceCurrentDate(currentDate, action);\n    dateProfile = reduceDateProfile(dateProfile, action, currentDate, currentViewData.dateProfileGenerator);\n\n    if (action.type === 'PREV' || // TODO: move this logic into DateProfileGenerator\n    action.type === 'NEXT' || // \"\n    !rangeContainsMarker(dateProfile.currentRange, currentDate)) {\n      currentDate = dateProfile.currentRange.start;\n    }\n\n    let eventSources = reduceEventSources(state.eventSources, action, dateProfile, calendarContext);\n    let eventStore = reduceEventStore(state.eventStore, action, eventSources, dateProfile, calendarContext);\n    let isEventsLoading = computeEventSourcesLoading(eventSources); // BAD. also called in this func in computeIsLoading\n\n    let renderableEventStore = isEventsLoading && !currentViewData.options.progressiveEventRendering ? state.renderableEventStore || eventStore : // try from previous state\n    eventStore;\n    let {\n      eventUiSingleBase,\n      selectionConfig\n    } = this.buildViewUiProps(calendarContext); // will memoize obj\n\n    let eventUiBySource = this.buildEventUiBySource(eventSources);\n    let eventUiBases = this.buildEventUiBases(renderableEventStore.defs, eventUiSingleBase, eventUiBySource);\n    let newState = {\n      dynamicOptionOverrides,\n      currentViewType,\n      currentDate,\n      dateProfile,\n      eventSources,\n      eventStore,\n      renderableEventStore,\n      selectionConfig,\n      eventUiBases,\n      businessHours: this.parseContextBusinessHours(calendarContext),\n      dateSelection: reduceDateSelection(state.dateSelection, action),\n      eventSelection: reduceSelectedEvent(state.eventSelection, action),\n      eventDrag: reduceEventDrag(state.eventDrag, action),\n      eventResize: reduceEventResize(state.eventResize, action)\n    };\n    let contextAndState = Object.assign(Object.assign({}, calendarContext), newState);\n\n    for (let reducer of optionsData.pluginHooks.reducers) {\n      Object.assign(newState, reducer(state, action, contextAndState)); // give the OLD state, for old value\n    }\n\n    let wasLoading = computeIsLoading(state, calendarContext);\n    let isLoading = computeIsLoading(newState, calendarContext); // TODO: use propSetHandlers in plugin system\n\n    if (!wasLoading && isLoading) {\n      emitter.trigger('loading', true);\n    } else if (wasLoading && !isLoading) {\n      emitter.trigger('loading', false);\n    }\n\n    this.state = newState;\n\n    if (props.onAction) {\n      props.onAction(action);\n    }\n  }\n\n  updateData() {\n    let {\n      props,\n      state\n    } = this;\n    let oldData = this.data;\n    let optionsData = this.computeOptionsData(props.optionOverrides, state.dynamicOptionOverrides, props.calendarApi);\n    let currentViewData = this.computeCurrentViewData(state.currentViewType, optionsData, props.optionOverrides, state.dynamicOptionOverrides);\n    let data = this.data = Object.assign(Object.assign(Object.assign({\n      viewTitle: this.buildTitle(state.dateProfile, currentViewData.options, optionsData.dateEnv),\n      calendarApi: props.calendarApi,\n      dispatch: this.dispatch,\n      emitter: this.emitter,\n      getCurrentData: this.getCurrentData\n    }, optionsData), currentViewData), state);\n    let changeHandlers = optionsData.pluginHooks.optionChangeHandlers;\n    let oldCalendarOptions = oldData && oldData.calendarOptions;\n    let newCalendarOptions = optionsData.calendarOptions;\n\n    if (oldCalendarOptions && oldCalendarOptions !== newCalendarOptions) {\n      if (oldCalendarOptions.timeZone !== newCalendarOptions.timeZone) {\n        // hack\n        state.eventSources = data.eventSources = reduceEventSourcesNewTimeZone(data.eventSources, state.dateProfile, data);\n        state.eventStore = data.eventStore = rezoneEventStoreDates(data.eventStore, oldData.dateEnv, data.dateEnv);\n        state.renderableEventStore = data.renderableEventStore = rezoneEventStoreDates(data.renderableEventStore, oldData.dateEnv, data.dateEnv);\n      }\n\n      for (let optionName in changeHandlers) {\n        if (this.optionsForHandling.indexOf(optionName) !== -1 || oldCalendarOptions[optionName] !== newCalendarOptions[optionName]) {\n          changeHandlers[optionName](newCalendarOptions[optionName], data);\n        }\n      }\n    }\n\n    this.optionsForHandling = [];\n\n    if (props.onData) {\n      props.onData(data);\n    }\n  }\n\n  computeOptionsData(optionOverrides, dynamicOptionOverrides, calendarApi) {\n    // TODO: blacklist options that are handled by optionChangeHandlers\n    if (!this.optionsForRefining.length && optionOverrides === this.stableOptionOverrides && dynamicOptionOverrides === this.stableDynamicOptionOverrides) {\n      return this.stableCalendarOptionsData;\n    }\n\n    let {\n      refinedOptions,\n      pluginHooks,\n      localeDefaults,\n      availableLocaleData,\n      extra\n    } = this.processRawCalendarOptions(optionOverrides, dynamicOptionOverrides);\n    warnUnknownOptions(extra);\n    let dateEnv = this.buildDateEnv(refinedOptions.timeZone, refinedOptions.locale, refinedOptions.weekNumberCalculation, refinedOptions.firstDay, refinedOptions.weekText, pluginHooks, availableLocaleData, refinedOptions.defaultRangeSeparator);\n    let viewSpecs = this.buildViewSpecs(pluginHooks.views, this.stableOptionOverrides, this.stableDynamicOptionOverrides, localeDefaults);\n    let theme = this.buildTheme(refinedOptions, pluginHooks);\n    let toolbarConfig = this.parseToolbars(refinedOptions, this.stableOptionOverrides, theme, viewSpecs, calendarApi);\n    return this.stableCalendarOptionsData = {\n      calendarOptions: refinedOptions,\n      pluginHooks,\n      dateEnv,\n      viewSpecs,\n      theme,\n      toolbarConfig,\n      localeDefaults,\n      availableRawLocales: availableLocaleData.map\n    };\n  } // always called from behind a memoizer\n\n\n  processRawCalendarOptions(optionOverrides, dynamicOptionOverrides) {\n    let {\n      locales,\n      locale\n    } = mergeRawOptions([BASE_OPTION_DEFAULTS, optionOverrides, dynamicOptionOverrides]);\n    let availableLocaleData = this.organizeRawLocales(locales);\n    let availableRawLocales = availableLocaleData.map;\n    let localeDefaults = this.buildLocale(locale || availableLocaleData.defaultCode, availableRawLocales).options;\n    let pluginHooks = this.buildPluginHooks(optionOverrides.plugins || [], globalPlugins);\n    let refiners = this.currentCalendarOptionsRefiners = Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({}, BASE_OPTION_REFINERS), CALENDAR_LISTENER_REFINERS), CALENDAR_OPTION_REFINERS), pluginHooks.listenerRefiners), pluginHooks.optionRefiners);\n    let extra = {};\n    let raw = mergeRawOptions([BASE_OPTION_DEFAULTS, localeDefaults, optionOverrides, dynamicOptionOverrides]);\n    let refined = {};\n    let currentRaw = this.currentCalendarOptionsInput;\n    let currentRefined = this.currentCalendarOptionsRefined;\n    let anyChanges = false;\n\n    for (let optionName in raw) {\n      if (this.optionsForRefining.indexOf(optionName) === -1 && (raw[optionName] === currentRaw[optionName] || COMPLEX_OPTION_COMPARATORS[optionName] && optionName in currentRaw && COMPLEX_OPTION_COMPARATORS[optionName](currentRaw[optionName], raw[optionName]))) {\n        refined[optionName] = currentRefined[optionName];\n      } else if (refiners[optionName]) {\n        refined[optionName] = refiners[optionName](raw[optionName]);\n        anyChanges = true;\n      } else {\n        extra[optionName] = currentRaw[optionName];\n      }\n    }\n\n    if (anyChanges) {\n      this.currentCalendarOptionsInput = raw;\n      this.currentCalendarOptionsRefined = refined;\n      this.stableOptionOverrides = optionOverrides;\n      this.stableDynamicOptionOverrides = dynamicOptionOverrides;\n    }\n\n    this.optionsForHandling.push(...this.optionsForRefining);\n    this.optionsForRefining = [];\n    return {\n      rawOptions: this.currentCalendarOptionsInput,\n      refinedOptions: this.currentCalendarOptionsRefined,\n      pluginHooks,\n      availableLocaleData,\n      localeDefaults,\n      extra\n    };\n  }\n\n  _computeCurrentViewData(viewType, optionsData, optionOverrides, dynamicOptionOverrides) {\n    let viewSpec = optionsData.viewSpecs[viewType];\n\n    if (!viewSpec) {\n      throw new Error(`viewType \"${viewType}\" is not available. Please make sure you've loaded all neccessary plugins`);\n    }\n\n    let {\n      refinedOptions,\n      extra\n    } = this.processRawViewOptions(viewSpec, optionsData.pluginHooks, optionsData.localeDefaults, optionOverrides, dynamicOptionOverrides);\n    warnUnknownOptions(extra);\n    let dateProfileGenerator = this.buildDateProfileGenerator({\n      dateProfileGeneratorClass: viewSpec.optionDefaults.dateProfileGeneratorClass,\n      duration: viewSpec.duration,\n      durationUnit: viewSpec.durationUnit,\n      usesMinMaxTime: viewSpec.optionDefaults.usesMinMaxTime,\n      dateEnv: optionsData.dateEnv,\n      calendarApi: this.props.calendarApi,\n      slotMinTime: refinedOptions.slotMinTime,\n      slotMaxTime: refinedOptions.slotMaxTime,\n      showNonCurrentDates: refinedOptions.showNonCurrentDates,\n      dayCount: refinedOptions.dayCount,\n      dateAlignment: refinedOptions.dateAlignment,\n      dateIncrement: refinedOptions.dateIncrement,\n      hiddenDays: refinedOptions.hiddenDays,\n      weekends: refinedOptions.weekends,\n      nowInput: refinedOptions.now,\n      validRangeInput: refinedOptions.validRange,\n      visibleRangeInput: refinedOptions.visibleRange,\n      fixedWeekCount: refinedOptions.fixedWeekCount\n    });\n    let viewApi = this.buildViewApi(viewType, this.getCurrentData, optionsData.dateEnv);\n    return {\n      viewSpec,\n      options: refinedOptions,\n      dateProfileGenerator,\n      viewApi\n    };\n  }\n\n  processRawViewOptions(viewSpec, pluginHooks, localeDefaults, optionOverrides, dynamicOptionOverrides) {\n    let raw = mergeRawOptions([BASE_OPTION_DEFAULTS, viewSpec.optionDefaults, localeDefaults, optionOverrides, viewSpec.optionOverrides, dynamicOptionOverrides]);\n    let refiners = Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({}, BASE_OPTION_REFINERS), CALENDAR_LISTENER_REFINERS), CALENDAR_OPTION_REFINERS), VIEW_OPTION_REFINERS), pluginHooks.listenerRefiners), pluginHooks.optionRefiners);\n    let refined = {};\n    let currentRaw = this.currentViewOptionsInput;\n    let currentRefined = this.currentViewOptionsRefined;\n    let anyChanges = false;\n    let extra = {};\n\n    for (let optionName in raw) {\n      if (raw[optionName] === currentRaw[optionName] || COMPLEX_OPTION_COMPARATORS[optionName] && COMPLEX_OPTION_COMPARATORS[optionName](raw[optionName], currentRaw[optionName])) {\n        refined[optionName] = currentRefined[optionName];\n      } else {\n        if (raw[optionName] === this.currentCalendarOptionsInput[optionName] || COMPLEX_OPTION_COMPARATORS[optionName] && COMPLEX_OPTION_COMPARATORS[optionName](raw[optionName], this.currentCalendarOptionsInput[optionName])) {\n          if (optionName in this.currentCalendarOptionsRefined) {\n            // might be an \"extra\" prop\n            refined[optionName] = this.currentCalendarOptionsRefined[optionName];\n          }\n        } else if (refiners[optionName]) {\n          refined[optionName] = refiners[optionName](raw[optionName]);\n        } else {\n          extra[optionName] = raw[optionName];\n        }\n\n        anyChanges = true;\n      }\n    }\n\n    if (anyChanges) {\n      this.currentViewOptionsInput = raw;\n      this.currentViewOptionsRefined = refined;\n    }\n\n    return {\n      rawOptions: this.currentViewOptionsInput,\n      refinedOptions: this.currentViewOptionsRefined,\n      extra\n    };\n  }\n\n}\n\nfunction buildDateEnv$1(timeZone, explicitLocale, weekNumberCalculation, firstDay, weekText, pluginHooks, availableLocaleData, defaultSeparator) {\n  let locale = buildLocale(explicitLocale || availableLocaleData.defaultCode, availableLocaleData.map);\n  return new DateEnv({\n    calendarSystem: 'gregory',\n    timeZone,\n    namedTimeZoneImpl: pluginHooks.namedTimeZonedImpl,\n    locale,\n    weekNumberCalculation,\n    firstDay,\n    weekText,\n    cmdFormatter: pluginHooks.cmdFormatter,\n    defaultSeparator\n  });\n}\n\nfunction buildTheme(options, pluginHooks) {\n  let ThemeClass = pluginHooks.themeClasses[options.themeSystem] || StandardTheme;\n  return new ThemeClass(options);\n}\n\nfunction buildDateProfileGenerator(props) {\n  let DateProfileGeneratorClass = props.dateProfileGeneratorClass || DateProfileGenerator;\n  return new DateProfileGeneratorClass(props);\n}\n\nfunction buildViewApi(type, getCurrentData, dateEnv) {\n  return new ViewImpl(type, getCurrentData, dateEnv);\n}\n\nfunction buildEventUiBySource(eventSources) {\n  return mapHash(eventSources, eventSource => eventSource.ui);\n}\n\nfunction buildEventUiBases(eventDefs, eventUiSingleBase, eventUiBySource) {\n  let eventUiBases = {\n    '': eventUiSingleBase\n  };\n\n  for (let defId in eventDefs) {\n    let def = eventDefs[defId];\n\n    if (def.sourceId && eventUiBySource[def.sourceId]) {\n      eventUiBases[defId] = eventUiBySource[def.sourceId];\n    }\n  }\n\n  return eventUiBases;\n}\n\nfunction buildViewUiProps(calendarContext) {\n  let {\n    options\n  } = calendarContext;\n  return {\n    eventUiSingleBase: createEventUi({\n      display: options.eventDisplay,\n      editable: options.editable,\n      startEditable: options.eventStartEditable,\n      durationEditable: options.eventDurationEditable,\n      constraint: options.eventConstraint,\n      overlap: typeof options.eventOverlap === 'boolean' ? options.eventOverlap : undefined,\n      allow: options.eventAllow,\n      backgroundColor: options.eventBackgroundColor,\n      borderColor: options.eventBorderColor,\n      textColor: options.eventTextColor,\n      color: options.eventColor // classNames: options.eventClassNames // render hook will handle this\n\n    }, calendarContext),\n    selectionConfig: createEventUi({\n      constraint: options.selectConstraint,\n      overlap: typeof options.selectOverlap === 'boolean' ? options.selectOverlap : undefined,\n      allow: options.selectAllow\n    }, calendarContext)\n  };\n}\n\nfunction computeIsLoading(state, context) {\n  for (let isLoadingFunc of context.pluginHooks.isLoadingFuncs) {\n    if (isLoadingFunc(state)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction parseContextBusinessHours(calendarContext) {\n  return parseBusinessHours(calendarContext.options.businessHours, calendarContext);\n}\n\nfunction warnUnknownOptions(options, viewName) {\n  for (let optionName in options) {\n    console.warn(`Unknown option '${optionName}'` + (viewName ? ` for view '${viewName}'` : ''));\n  }\n}\n\nclass ToolbarSection extends BaseComponent {\n  render() {\n    let children = this.props.widgetGroups.map(widgetGroup => this.renderWidgetGroup(widgetGroup));\n    return createElement('div', {\n      className: 'fc-toolbar-chunk'\n    }, ...children);\n  }\n\n  renderWidgetGroup(widgetGroup) {\n    let {\n      props\n    } = this;\n    let {\n      theme\n    } = this.context;\n    let children = [];\n    let isOnlyButtons = true;\n\n    for (let widget of widgetGroup) {\n      let {\n        buttonName,\n        buttonClick,\n        buttonText,\n        buttonIcon,\n        buttonHint\n      } = widget;\n\n      if (buttonName === 'title') {\n        isOnlyButtons = false;\n        children.push(createElement(\"h2\", {\n          className: \"fc-toolbar-title\",\n          id: props.titleId\n        }, props.title));\n      } else {\n        let isPressed = buttonName === props.activeButton;\n        let isDisabled = !props.isTodayEnabled && buttonName === 'today' || !props.isPrevEnabled && buttonName === 'prev' || !props.isNextEnabled && buttonName === 'next';\n        let buttonClasses = [`fc-${buttonName}-button`, theme.getClass('button')];\n\n        if (isPressed) {\n          buttonClasses.push(theme.getClass('buttonActive'));\n        }\n\n        children.push(createElement(\"button\", {\n          type: \"button\",\n          title: typeof buttonHint === 'function' ? buttonHint(props.navUnit) : buttonHint,\n          disabled: isDisabled,\n          \"aria-pressed\": isPressed,\n          className: buttonClasses.join(' '),\n          onClick: buttonClick\n        }, buttonText || (buttonIcon ? createElement(\"span\", {\n          className: buttonIcon,\n          role: \"img\"\n        }) : '')));\n      }\n    }\n\n    if (children.length > 1) {\n      let groupClassName = isOnlyButtons && theme.getClass('buttonGroup') || '';\n      return createElement('div', {\n        className: groupClassName\n      }, ...children);\n    }\n\n    return children[0];\n  }\n\n}\n\nclass Toolbar extends BaseComponent {\n  render() {\n    let {\n      model,\n      extraClassName\n    } = this.props;\n    let forceLtr = false;\n    let startContent;\n    let endContent;\n    let sectionWidgets = model.sectionWidgets;\n    let centerContent = sectionWidgets.center;\n\n    if (sectionWidgets.left) {\n      forceLtr = true;\n      startContent = sectionWidgets.left;\n    } else {\n      startContent = sectionWidgets.start;\n    }\n\n    if (sectionWidgets.right) {\n      forceLtr = true;\n      endContent = sectionWidgets.right;\n    } else {\n      endContent = sectionWidgets.end;\n    }\n\n    let classNames = [extraClassName || '', 'fc-toolbar', forceLtr ? 'fc-toolbar-ltr' : ''];\n    return createElement(\"div\", {\n      className: classNames.join(' ')\n    }, this.renderSection('start', startContent || []), this.renderSection('center', centerContent || []), this.renderSection('end', endContent || []));\n  }\n\n  renderSection(key, widgetGroups) {\n    let {\n      props\n    } = this;\n    return createElement(ToolbarSection, {\n      key: key,\n      widgetGroups: widgetGroups,\n      title: props.title,\n      navUnit: props.navUnit,\n      activeButton: props.activeButton,\n      isTodayEnabled: props.isTodayEnabled,\n      isPrevEnabled: props.isPrevEnabled,\n      isNextEnabled: props.isNextEnabled,\n      titleId: props.titleId\n    });\n  }\n\n}\n\nclass ViewHarness extends BaseComponent {\n  constructor() {\n    super(...arguments);\n    this.state = {\n      availableWidth: null\n    };\n\n    this.handleEl = el => {\n      this.el = el;\n      setRef(this.props.elRef, el);\n      this.updateAvailableWidth();\n    };\n\n    this.handleResize = () => {\n      this.updateAvailableWidth();\n    };\n  }\n\n  render() {\n    let {\n      props,\n      state\n    } = this;\n    let {\n      aspectRatio\n    } = props;\n    let classNames = ['fc-view-harness', aspectRatio || props.liquid || props.height ? 'fc-view-harness-active' // harness controls the height\n    : 'fc-view-harness-passive' // let the view do the height\n    ];\n    let height = '';\n    let paddingBottom = '';\n\n    if (aspectRatio) {\n      if (state.availableWidth !== null) {\n        height = state.availableWidth / aspectRatio;\n      } else {\n        // while waiting to know availableWidth, we can't set height to *zero*\n        // because will cause lots of unnecessary scrollbars within scrollgrid.\n        // BETTER: don't start rendering ANYTHING yet until we know container width\n        // NOTE: why not always use paddingBottom? Causes height oscillation (issue 5606)\n        paddingBottom = `${1 / aspectRatio * 100}%`;\n      }\n    } else {\n      height = props.height || '';\n    }\n\n    return createElement(\"div\", {\n      \"aria-labelledby\": props.labeledById,\n      ref: this.handleEl,\n      className: classNames.join(' '),\n      style: {\n        height,\n        paddingBottom\n      }\n    }, props.children);\n  }\n\n  componentDidMount() {\n    this.context.addResizeHandler(this.handleResize);\n  }\n\n  componentWillUnmount() {\n    this.context.removeResizeHandler(this.handleResize);\n  }\n\n  updateAvailableWidth() {\n    if (this.el && // needed. but why?\n    this.props.aspectRatio // aspectRatio is the only height setting that needs availableWidth\n    ) {\n      this.setState({\n        availableWidth: this.el.offsetWidth\n      });\n    }\n  }\n\n}\n/*\nDetects when the user clicks on an event within a DateComponent\n*/\n\n\nclass EventClicking extends Interaction {\n  constructor(settings) {\n    super(settings);\n\n    this.handleSegClick = (ev, segEl) => {\n      let {\n        component\n      } = this;\n      let {\n        context\n      } = component;\n      let seg = getElSeg(segEl);\n\n      if (seg && // might be the <div> surrounding the more link\n      component.isValidSegDownEl(ev.target)) {\n        // our way to simulate a link click for elements that can't be <a> tags\n        // grab before trigger fired in case trigger trashes DOM thru rerendering\n        let hasUrlContainer = elementClosest(ev.target, '.fc-event-forced-url');\n        let url = hasUrlContainer ? hasUrlContainer.querySelector('a[href]').href : '';\n        context.emitter.trigger('eventClick', {\n          el: segEl,\n          event: new EventImpl(component.context, seg.eventRange.def, seg.eventRange.instance),\n          jsEvent: ev,\n          view: context.viewApi\n        });\n\n        if (url && !ev.defaultPrevented) {\n          window.location.href = url;\n        }\n      }\n    };\n\n    this.destroy = listenBySelector(settings.el, 'click', '.fc-event', // on both fg and bg events\n    this.handleSegClick);\n  }\n\n}\n/*\nTriggers events and adds/removes core classNames when the user's pointer\nenters/leaves event-elements of a component.\n*/\n\n\nclass EventHovering extends Interaction {\n  constructor(settings) {\n    super(settings); // for simulating an eventMouseLeave when the event el is destroyed while mouse is over it\n\n    this.handleEventElRemove = el => {\n      if (el === this.currentSegEl) {\n        this.handleSegLeave(null, this.currentSegEl);\n      }\n    };\n\n    this.handleSegEnter = (ev, segEl) => {\n      if (getElSeg(segEl)) {\n        // TODO: better way to make sure not hovering over more+ link or its wrapper\n        this.currentSegEl = segEl;\n        this.triggerEvent('eventMouseEnter', ev, segEl);\n      }\n    };\n\n    this.handleSegLeave = (ev, segEl) => {\n      if (this.currentSegEl) {\n        this.currentSegEl = null;\n        this.triggerEvent('eventMouseLeave', ev, segEl);\n      }\n    };\n\n    this.removeHoverListeners = listenToHoverBySelector(settings.el, '.fc-event', // on both fg and bg events\n    this.handleSegEnter, this.handleSegLeave);\n  }\n\n  destroy() {\n    this.removeHoverListeners();\n  }\n\n  triggerEvent(publicEvName, ev, segEl) {\n    let {\n      component\n    } = this;\n    let {\n      context\n    } = component;\n    let seg = getElSeg(segEl);\n\n    if (!ev || component.isValidSegDownEl(ev.target)) {\n      context.emitter.trigger(publicEvName, {\n        el: segEl,\n        event: new EventImpl(context, seg.eventRange.def, seg.eventRange.instance),\n        jsEvent: ev,\n        view: context.viewApi\n      });\n    }\n  }\n\n}\n\nclass CalendarContent extends PureComponent {\n  constructor() {\n    super(...arguments);\n    this.buildViewContext = memoize(buildViewContext);\n    this.buildViewPropTransformers = memoize(buildViewPropTransformers);\n    this.buildToolbarProps = memoize(buildToolbarProps);\n    this.headerRef = createRef();\n    this.footerRef = createRef();\n    this.interactionsStore = {}; // eslint-disable-next-line\n\n    this.state = {\n      viewLabelId: getUniqueDomId()\n    }; // Component Registration\n    // -----------------------------------------------------------------------------------------------------------------\n\n    this.registerInteractiveComponent = (component, settingsInput) => {\n      let settings = parseInteractionSettings(component, settingsInput);\n      let DEFAULT_INTERACTIONS = [EventClicking, EventHovering];\n      let interactionClasses = DEFAULT_INTERACTIONS.concat(this.props.pluginHooks.componentInteractions);\n      let interactions = interactionClasses.map(TheInteractionClass => new TheInteractionClass(settings));\n      this.interactionsStore[component.uid] = interactions;\n      interactionSettingsStore[component.uid] = settings;\n    };\n\n    this.unregisterInteractiveComponent = component => {\n      let listeners = this.interactionsStore[component.uid];\n\n      if (listeners) {\n        for (let listener of listeners) {\n          listener.destroy();\n        }\n\n        delete this.interactionsStore[component.uid];\n      }\n\n      delete interactionSettingsStore[component.uid];\n    }; // Resizing\n    // -----------------------------------------------------------------------------------------------------------------\n\n\n    this.resizeRunner = new DelayedRunner(() => {\n      this.props.emitter.trigger('_resize', true); // should window resizes be considered \"forced\" ?\n\n      this.props.emitter.trigger('windowResize', {\n        view: this.props.viewApi\n      });\n    });\n\n    this.handleWindowResize = ev => {\n      let {\n        options\n      } = this.props;\n\n      if (options.handleWindowResize && ev.target === window // avoid jqui events\n      ) {\n        this.resizeRunner.request(options.windowResizeDelay);\n      }\n    };\n  }\n  /*\n  renders INSIDE of an outer div\n  */\n\n\n  render() {\n    let {\n      props\n    } = this;\n    let {\n      toolbarConfig,\n      options\n    } = props;\n    let toolbarProps = this.buildToolbarProps(props.viewSpec, props.dateProfile, props.dateProfileGenerator, props.currentDate, getNow(props.options.now, props.dateEnv), // TODO: use NowTimer????\n    props.viewTitle);\n    let viewVGrow = false;\n    let viewHeight = '';\n    let viewAspectRatio;\n\n    if (props.isHeightAuto || props.forPrint) {\n      viewHeight = '';\n    } else if (options.height != null) {\n      viewVGrow = true;\n    } else if (options.contentHeight != null) {\n      viewHeight = options.contentHeight;\n    } else {\n      viewAspectRatio = Math.max(options.aspectRatio, 0.5); // prevent from getting too tall\n    }\n\n    let viewContext = this.buildViewContext(props.viewSpec, props.viewApi, props.options, props.dateProfileGenerator, props.dateEnv, props.theme, props.pluginHooks, props.dispatch, props.getCurrentData, props.emitter, props.calendarApi, this.registerInteractiveComponent, this.unregisterInteractiveComponent);\n    let viewLabelId = toolbarConfig.header && toolbarConfig.header.hasTitle ? this.state.viewLabelId : undefined;\n    return createElement(ViewContextType.Provider, {\n      value: viewContext\n    }, toolbarConfig.header && createElement(Toolbar, Object.assign({\n      ref: this.headerRef,\n      extraClassName: \"fc-header-toolbar\",\n      model: toolbarConfig.header,\n      titleId: viewLabelId\n    }, toolbarProps)), createElement(ViewHarness, {\n      liquid: viewVGrow,\n      height: viewHeight,\n      aspectRatio: viewAspectRatio,\n      labeledById: viewLabelId\n    }, this.renderView(props), this.buildAppendContent()), toolbarConfig.footer && createElement(Toolbar, Object.assign({\n      ref: this.footerRef,\n      extraClassName: \"fc-footer-toolbar\",\n      model: toolbarConfig.footer,\n      titleId: \"\"\n    }, toolbarProps)));\n  }\n\n  componentDidMount() {\n    let {\n      props\n    } = this;\n    this.calendarInteractions = props.pluginHooks.calendarInteractions.map(CalendarInteractionClass => new CalendarInteractionClass(props));\n    window.addEventListener('resize', this.handleWindowResize);\n    let {\n      propSetHandlers\n    } = props.pluginHooks;\n\n    for (let propName in propSetHandlers) {\n      propSetHandlers[propName](props[propName], props);\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    let {\n      props\n    } = this;\n    let {\n      propSetHandlers\n    } = props.pluginHooks;\n\n    for (let propName in propSetHandlers) {\n      if (props[propName] !== prevProps[propName]) {\n        propSetHandlers[propName](props[propName], props);\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.handleWindowResize);\n    this.resizeRunner.clear();\n\n    for (let interaction of this.calendarInteractions) {\n      interaction.destroy();\n    }\n\n    this.props.emitter.trigger('_unmount');\n  }\n\n  buildAppendContent() {\n    let {\n      props\n    } = this;\n    let children = props.pluginHooks.viewContainerAppends.map(buildAppendContent => buildAppendContent(props));\n    return createElement(Fragment, {}, ...children);\n  }\n\n  renderView(props) {\n    let {\n      pluginHooks\n    } = props;\n    let {\n      viewSpec\n    } = props;\n    let viewProps = {\n      dateProfile: props.dateProfile,\n      businessHours: props.businessHours,\n      eventStore: props.renderableEventStore,\n      eventUiBases: props.eventUiBases,\n      dateSelection: props.dateSelection,\n      eventSelection: props.eventSelection,\n      eventDrag: props.eventDrag,\n      eventResize: props.eventResize,\n      isHeightAuto: props.isHeightAuto,\n      forPrint: props.forPrint\n    };\n    let transformers = this.buildViewPropTransformers(pluginHooks.viewPropsTransformers);\n\n    for (let transformer of transformers) {\n      Object.assign(viewProps, transformer.transform(viewProps, props));\n    }\n\n    let ViewComponent = viewSpec.component;\n    return createElement(ViewComponent, Object.assign({}, viewProps));\n  }\n\n}\n\nfunction buildToolbarProps(viewSpec, dateProfile, dateProfileGenerator, currentDate, now, title) {\n  // don't force any date-profiles to valid date profiles (the `false`) so that we can tell if it's invalid\n  let todayInfo = dateProfileGenerator.build(now, undefined, false); // TODO: need `undefined` or else INFINITE LOOP for some reason\n\n  let prevInfo = dateProfileGenerator.buildPrev(dateProfile, currentDate, false);\n  let nextInfo = dateProfileGenerator.buildNext(dateProfile, currentDate, false);\n  return {\n    title,\n    activeButton: viewSpec.type,\n    navUnit: viewSpec.singleUnit,\n    isTodayEnabled: todayInfo.isValid && !rangeContainsMarker(dateProfile.currentRange, now),\n    isPrevEnabled: prevInfo.isValid,\n    isNextEnabled: nextInfo.isValid\n  };\n} // Plugin\n// -----------------------------------------------------------------------------------------------------------------\n\n\nfunction buildViewPropTransformers(theClasses) {\n  return theClasses.map(TheClass => new TheClass());\n}\n\nclass Calendar extends CalendarImpl {\n  constructor(el, optionOverrides = {}) {\n    super();\n    this.isRendering = false;\n    this.isRendered = false;\n    this.currentClassNames = [];\n    this.customContentRenderId = 0;\n\n    this.handleAction = action => {\n      // actions we know we want to render immediately\n      switch (action.type) {\n        case 'SET_EVENT_DRAG':\n        case 'SET_EVENT_RESIZE':\n          this.renderRunner.tryDrain();\n      }\n    };\n\n    this.handleData = data => {\n      this.currentData = data;\n      this.renderRunner.request(data.calendarOptions.rerenderDelay);\n    };\n\n    this.handleRenderRequest = () => {\n      if (this.isRendering) {\n        this.isRendered = true;\n        let {\n          currentData\n        } = this;\n        flushSync(() => {\n          render(createElement(CalendarRoot, {\n            options: currentData.calendarOptions,\n            theme: currentData.theme,\n            emitter: currentData.emitter\n          }, (classNames, height, isHeightAuto, forPrint) => {\n            this.setClassNames(classNames);\n            this.setHeight(height);\n            return createElement(RenderId.Provider, {\n              value: this.customContentRenderId\n            }, createElement(CalendarContent, Object.assign({\n              isHeightAuto: isHeightAuto,\n              forPrint: forPrint\n            }, currentData)));\n          }), this.el);\n        });\n      } else if (this.isRendered) {\n        this.isRendered = false;\n        render(null, this.el);\n        this.setClassNames([]);\n        this.setHeight('');\n      }\n    };\n\n    ensureElHasStyles(el);\n    this.el = el;\n    this.renderRunner = new DelayedRunner(this.handleRenderRequest);\n    new CalendarDataManager({\n      optionOverrides,\n      calendarApi: this,\n      onAction: this.handleAction,\n      onData: this.handleData\n    });\n  }\n\n  render() {\n    let wasRendering = this.isRendering;\n\n    if (!wasRendering) {\n      this.isRendering = true;\n    } else {\n      this.customContentRenderId += 1;\n    }\n\n    this.renderRunner.request();\n\n    if (wasRendering) {\n      this.updateSize();\n    }\n  }\n\n  destroy() {\n    if (this.isRendering) {\n      this.isRendering = false;\n      this.renderRunner.request();\n    }\n  }\n\n  updateSize() {\n    flushSync(() => {\n      super.updateSize();\n    });\n  }\n\n  batchRendering(func) {\n    this.renderRunner.pause('batchRendering');\n    func();\n    this.renderRunner.resume('batchRendering');\n  }\n\n  pauseRendering() {\n    this.renderRunner.pause('pauseRendering');\n  }\n\n  resumeRendering() {\n    this.renderRunner.resume('pauseRendering', true);\n  }\n\n  resetOptions(optionOverrides, changedOptionNames) {\n    this.currentDataManager.resetOptions(optionOverrides, changedOptionNames);\n  }\n\n  setClassNames(classNames) {\n    if (!isArraysEqual(classNames, this.currentClassNames)) {\n      let {\n        classList\n      } = this.el;\n\n      for (let className of this.currentClassNames) {\n        classList.remove(className);\n      }\n\n      for (let className of classNames) {\n        classList.add(className);\n      }\n\n      this.currentClassNames = classNames;\n    }\n  }\n\n  setHeight(height) {\n    applyStyleProp(this.el, 'height', height);\n  }\n\n}\n\nfunction formatDate(dateInput, options = {}) {\n  let dateEnv = buildDateEnv(options);\n  let formatter = createFormatter(options);\n  let dateMeta = dateEnv.createMarkerMeta(dateInput);\n\n  if (!dateMeta) {\n    // TODO: warning?\n    return '';\n  }\n\n  return dateEnv.format(dateMeta.marker, formatter, {\n    forcedTzo: dateMeta.forcedTzo\n  });\n}\n\nfunction formatRange(startInput, endInput, options) {\n  let dateEnv = buildDateEnv(typeof options === 'object' && options ? options : {}); // pass in if non-null object\n\n  let formatter = createFormatter(options);\n  let startMeta = dateEnv.createMarkerMeta(startInput);\n  let endMeta = dateEnv.createMarkerMeta(endInput);\n\n  if (!startMeta || !endMeta) {\n    // TODO: warning?\n    return '';\n  }\n\n  return dateEnv.formatRange(startMeta.marker, endMeta.marker, formatter, {\n    forcedStartTzo: startMeta.forcedTzo,\n    forcedEndTzo: endMeta.forcedTzo,\n    isEndExclusive: options.isEndExclusive,\n    defaultSeparator: BASE_OPTION_DEFAULTS.defaultRangeSeparator\n  });\n} // TODO: more DRY and optimized\n\n\nfunction buildDateEnv(settings) {\n  let locale = buildLocale(settings.locale || 'en', organizeRawLocales([]).map); // TODO: don't hardcode 'en' everywhere\n\n  return new DateEnv(Object.assign(Object.assign({\n    timeZone: BASE_OPTION_DEFAULTS.timeZone,\n    calendarSystem: 'gregory'\n  }, settings), {\n    locale\n  }));\n} // HELPERS\n\n/*\nif nextDayThreshold is specified, slicing is done in an all-day fashion.\nyou can get nextDayThreshold from context.nextDayThreshold\n*/\n\n\nfunction sliceEvents(props, allDay) {\n  return sliceEventStore(props.eventStore, props.eventUiBases, props.dateProfile.activeRange, allDay ? props.nextDayThreshold : null).fg;\n}\n\nconst version = '6.1.11';\nexport { Calendar, createPlugin, formatDate, formatRange, globalLocales, globalPlugins, sliceEvents, version };","map":{"version":3,"names":["m","mergeProps","g","guid","i","isArraysEqual","T","Theme","a","mapHash","B","BaseComponent","V","ViewContextType","C","ContentContainer","b","buildViewClassNames","c","greatestDurationDenominator","d","createDuration","e","BASE_OPTION_DEFAULTS","f","arrayToHash","h","filterHash","j","buildEventSourceRefiners","p","parseEventSource","k","formatWithOrdinals","u","unpromisify","l","buildRangeApiWithTimeZone","n","identity","r","requestJson","s","subtractDurations","o","intersectRanges","q","startOfDay","t","addDays","v","hashValuesToArray","w","buildEventApis","D","DelayedRunner","x","createFormatter","y","diffWholeDays","z","memoize","A","memoizeObjArg","E","isPropsEqual","F","Emitter","G","getInitialDate","H","rangeContainsMarker","I","createEmptyEventStore","J","reduceCurrentDate","K","reduceEventStore","L","rezoneEventStoreDates","M","mergeRawOptions","N","BASE_OPTION_REFINERS","O","CALENDAR_LISTENER_REFINERS","P","CALENDAR_OPTION_REFINERS","Q","COMPLEX_OPTION_COMPARATORS","R","VIEW_OPTION_REFINERS","S","DateEnv","U","DateProfileGenerator","W","createEventUi","X","parseBusinessHours","Y","setRef","Z","Interaction","_","getElSeg","$","elementClosest","a0","EventImpl","a1","listenBySelector","a2","listenToHoverBySelector","a3","PureComponent","a4","buildViewContext","a5","getUniqueDomId","a6","parseInteractionSettings","a7","interactionSettingsStore","a8","getNow","a9","CalendarImpl","aa","flushSync","ab","CalendarRoot","ac","RenderId","ad","ensureElHasStyles","ae","applyStyleProp","af","sliceEventStore","ag","JsonRequestError","createElement","createRef","Fragment","render","globalLocales","MINIMAL_RAW_EN_LOCALE","code","week","dow","doy","direction","buttonText","prev","next","prevYear","nextYear","year","today","month","day","list","weekText","weekTextLong","closeHint","timeHint","eventHint","allDayText","moreLinkText","noEventsText","RAW_EN_LOCALE","Object","assign","buttonHints","unit","viewHint","navLinkHint","moreLinkHint","eventCnt","organizeRawLocales","explicitRawLocales","defaultCode","length","allRawLocales","concat","rawLocaleMap","en","rawLocale","map","buildLocale","inputSingular","available","Array","isArray","parseLocale","queryLocale","codeArg","codes","raw","queryRawLocale","parts","toLocaleLowerCase","split","simpleId","slice","join","merged","simpleNumberFormat","Intl","NumberFormat","options","createPlugin","input","id","name","premiumReleaseDate","Date","undefined","deps","reducers","isLoadingFuncs","contextInit","eventRefiners","eventDefMemberAdders","eventSourceRefiners","isDraggableTransformers","eventDragMutationMassagers","eventDefMutationAppliers","dateSelectionTransformers","datePointTransforms","dateSpanTransforms","views","viewPropsTransformers","isPropsValid","externalDefTransforms","viewContainerAppends","eventDropTransformers","componentInteractions","calendarInteractions","themeClasses","eventSourceDefs","cmdFormatter","recurringTypes","namedTimeZonedImpl","initialView","elementDraggingImpl","optionChangeHandlers","scrollGridImpl","listenerRefiners","optionRefiners","propSetHandlers","buildPluginHooks","pluginDefs","globalDefs","currentPluginIds","hooks","addDefs","defs","def","pluginName","currentId","combineHooks","console","warn","buildBuildPluginHooks","currentOverrideDefs","currentGlobalDefs","currentHooks","overrideDefs","hooks0","hooks1","compareOptionalDates","date0","date1","Math","max","valueOf","StandardTheme","prototype","classes","root","tableCellShaded","buttonGroup","button","buttonActive","baseIconClass","iconClasses","close","rtlIconClasses","iconOverrideOption","iconOverrideCustomButtonOption","iconOverridePrefix","compileViewDefs","defaultConfigs","overrideConfigs","hash","viewType","ensureViewDef","viewDef","buildViewDef","defaultConfig","overrideConfig","queryProp","theComponent","superType","superDef","Error","component","type","defaults","rawOptions","overrides","parseViewConfigs","inputs","parseViewConfig","content","createViewHookComponent","viewProps","Consumer","context","elTag","elClasses","viewSpec","renderProps","nextDayThreshold","generatorName","customGenerator","classNameGenerator","classNames","didMount","willUnmount","buildViewSpecs","defaultInputs","optionOverrides","dynamicOptionOverrides","localeDefaults","viewDefs","buildViewSpec","durationInput","duration","durationUnit","singleUnit","singleUnitOverrides","createDurationCached","denom","value","queryButtonText","optionsSubset","buttonTextMap","buttonTextKey","queryButtonTitle","buttonKey","optionDefaults","buttonTextOverride","buttonTextDefault","buttonTitleOverride","buttonHint","buttonTitleDefault","durationInputMap","json","JSON","stringify","res","reduceViewType","action","reduceDynamicOptionOverrides","optionName","rawOptionValue","reduceDateProfile","currentDateProfile","currentDate","dateProfileGenerator","dp","build","dateMarker","buildPrev","isValid","buildNext","initEventSources","calendarOptions","dateProfile","activeRange","addSources","parseInitialSources","reduceEventSources","eventSources","sources","removeSource","sourceId","fetchDirtySources","fetchSourcesByIds","sourceIds","excludeStaticSources","isRefetch","receiveResponse","fetchId","fetchRange","reduceEventSourcesNewTimeZone","computeEventSourcesLoading","isFetching","eventSourceHash","source","eventSource","sourceHash","isSourceDirty","doesSourceNeedRange","latestFetchId","lazyFetching","start","end","prevSources","sourceIdHash","nextSources","fetchSource","calendarApi","sourceDef","pluginHooks","sourceDefId","fetch","range","rawEvents","eventSourceSuccess","call","response","success","dispatch","error","errorHandled","eventSourceFailure","failure","message","refiners","rawSources","initialEvents","unshift","events","rawSource","push","ignoreRange","reduceDateSelection","currentSelection","selection","reduceSelectedEvent","currentInstanceId","eventInstanceId","reduceEventDrag","currentDrag","newDrag","state","affectedEvents","mutatedEvents","isEvent","reduceEventResize","currentResize","newResize","parseToolbars","calendarOptionOverrides","theme","viewSpecs","header","headerToolbar","parseToolbar","footer","footerToolbar","sectionStrHash","sectionWidgets","viewsWithButtons","hasTitle","sectionName","sectionStr","sectionRes","parseSection","widgets","isRtl","calendarCustomButtons","customButtons","calendarButtonTextOverrides","calendarButtonText","calendarButtonHintOverrides","calendarButtonHints","sectionSubstrs","buttonGroupStr","buttonName","customButtonProps","buttonClick","buttonIcon","ev","click","target","getCustomButtonIconClass","getIconClass","text","hint","changeView","textFallback","prevOrNext","navUnit","ViewImpl","constructor","getCurrentData","dateEnv","calendar","title","viewTitle","activeStart","toDate","activeEnd","currentStart","currentRange","currentEnd","getOption","eventSourceDef$2","parseMeta","refined","arg","successCallback","meta","arrayEventSourcePlugin","eventSourceDef$1","errorCallback","func","bind","funcEventSourcePlugin","JSON_FEED_EVENT_SOURCE_REFINERS","method","String","extraParams","startParam","endParam","timeZoneParam","eventSourceDef","url","format","toUpperCase","requestParams","buildRequestParams","then","jsonFeedEventSourcePlugin","customRequestParams","params","formatIso","timeZone","SIMPLE_RECURRING_REFINERS","daysOfWeek","startTime","endTime","startRecur","endRecur","recurring","parse","recurringData","createMarker","allDayGuess","Boolean","typeData","expand","framingRange","clippedFramingRange","expandRanges","simpleRecurringEventsPlugin","dowHash","dayMarker","endMarker","instanceStarts","instanceStart","getUTCDay","add","changeHandlerPlugin","handleEventSources","unfoundSources","_raw","newInputs","inputFound","splice","unfoundSource","newInput","addEventSource","handleDateProfile","emitter","trigger","view","viewApi","handleEventStore","eventStore","hasHandlers","globalPlugins","TaskRunner","runTaskOption","drainedOption","queue","delayedRunner","drain","request","task","delay","pause","scope","resume","force","completedTasks","shift","runTask","drained","buildTitle","viewOptions","test","currentRangeUnit","formatRange","titleFormat","buildTitleFormat","isEndExclusive","isRangeAllDay","defaultSeparator","titleRangeSeparator","days","CalendarDataManager","props","computeCurrentViewData","_computeCurrentViewData","buildDateEnv","buildDateEnv$1","buildTheme","buildDateProfileGenerator","buildViewApi","buildViewUiProps","buildEventUiBySource","buildEventUiBases","parseContextBusinessHours","actionRunner","_handleAction","updateData","currentCalendarOptionsInput","currentCalendarOptionsRefined","currentViewOptionsInput","currentViewOptionsRefined","currentCalendarOptionsRefiners","optionsForRefining","optionsForHandling","data","optionsData","computeOptionsData","currentViewType","currentViewData","currentDataManager","setThisContext","setOptions","calendarContext","callback","initialState","businessHours","eventUiBases","renderableEventStore","dateSelection","eventSelection","eventDrag","eventResize","selectionConfig","contextAndState","reducer","computeIsLoading","resetOptions","changedOptionNames","isEventsLoading","progressiveEventRendering","eventUiSingleBase","eventUiBySource","newState","wasLoading","isLoading","onAction","oldData","changeHandlers","oldCalendarOptions","newCalendarOptions","indexOf","onData","stableOptionOverrides","stableDynamicOptionOverrides","stableCalendarOptionsData","refinedOptions","availableLocaleData","extra","processRawCalendarOptions","warnUnknownOptions","locale","weekNumberCalculation","firstDay","defaultRangeSeparator","toolbarConfig","availableRawLocales","locales","plugins","currentRaw","currentRefined","anyChanges","processRawViewOptions","dateProfileGeneratorClass","usesMinMaxTime","slotMinTime","slotMaxTime","showNonCurrentDates","dayCount","dateAlignment","dateIncrement","hiddenDays","weekends","nowInput","now","validRangeInput","validRange","visibleRangeInput","visibleRange","fixedWeekCount","explicitLocale","calendarSystem","namedTimeZoneImpl","ThemeClass","themeSystem","DateProfileGeneratorClass","ui","eventDefs","defId","display","eventDisplay","editable","startEditable","eventStartEditable","durationEditable","eventDurationEditable","constraint","eventConstraint","overlap","eventOverlap","allow","eventAllow","backgroundColor","eventBackgroundColor","borderColor","eventBorderColor","textColor","eventTextColor","color","eventColor","selectConstraint","selectOverlap","selectAllow","isLoadingFunc","viewName","ToolbarSection","children","widgetGroups","widgetGroup","renderWidgetGroup","className","isOnlyButtons","widget","titleId","isPressed","activeButton","isDisabled","isTodayEnabled","isPrevEnabled","isNextEnabled","buttonClasses","getClass","disabled","onClick","role","groupClassName","Toolbar","model","extraClassName","forceLtr","startContent","endContent","centerContent","center","left","right","renderSection","key","ViewHarness","arguments","availableWidth","handleEl","el","elRef","updateAvailableWidth","handleResize","aspectRatio","liquid","height","paddingBottom","labeledById","ref","style","componentDidMount","addResizeHandler","componentWillUnmount","removeResizeHandler","setState","offsetWidth","EventClicking","settings","handleSegClick","segEl","seg","isValidSegDownEl","hasUrlContainer","querySelector","href","event","eventRange","instance","jsEvent","defaultPrevented","window","location","destroy","EventHovering","handleEventElRemove","currentSegEl","handleSegLeave","handleSegEnter","triggerEvent","removeHoverListeners","publicEvName","CalendarContent","buildViewPropTransformers","buildToolbarProps","headerRef","footerRef","interactionsStore","viewLabelId","registerInteractiveComponent","settingsInput","DEFAULT_INTERACTIONS","interactionClasses","interactions","TheInteractionClass","uid","unregisterInteractiveComponent","listeners","listener","resizeRunner","handleWindowResize","windowResizeDelay","toolbarProps","viewVGrow","viewHeight","viewAspectRatio","isHeightAuto","forPrint","contentHeight","viewContext","Provider","renderView","buildAppendContent","CalendarInteractionClass","addEventListener","propName","componentDidUpdate","prevProps","removeEventListener","clear","interaction","transformers","transformer","transform","ViewComponent","todayInfo","prevInfo","nextInfo","theClasses","TheClass","Calendar","isRendering","isRendered","currentClassNames","customContentRenderId","handleAction","renderRunner","tryDrain","handleData","currentData","rerenderDelay","handleRenderRequest","setClassNames","setHeight","wasRendering","updateSize","batchRendering","pauseRendering","resumeRendering","classList","remove","formatDate","dateInput","formatter","dateMeta","createMarkerMeta","marker","forcedTzo","startInput","endInput","startMeta","endMeta","forcedStartTzo","forcedEndTzo","sliceEvents","allDay","fg","version"],"sources":["/home/pat/Repositories/caretrackplus/node_modules/@fullcalendar/core/index.js"],"sourcesContent":["import { m as mergeProps, g as guid, i as isArraysEqual, T as Theme, a as mapHash, B as BaseComponent, V as ViewContextType, C as ContentContainer, b as buildViewClassNames, c as greatestDurationDenominator, d as createDuration, e as BASE_OPTION_DEFAULTS, f as arrayToHash, h as filterHash, j as buildEventSourceRefiners, p as parseEventSource, k as formatWithOrdinals, u as unpromisify, l as buildRangeApiWithTimeZone, n as identity, r as requestJson, s as subtractDurations, o as intersectRanges, q as startOfDay, t as addDays, v as hashValuesToArray, w as buildEventApis, D as DelayedRunner, x as createFormatter, y as diffWholeDays, z as memoize, A as memoizeObjArg, E as isPropsEqual, F as Emitter, G as getInitialDate, H as rangeContainsMarker, I as createEmptyEventStore, J as reduceCurrentDate, K as reduceEventStore, L as rezoneEventStoreDates, M as mergeRawOptions, N as BASE_OPTION_REFINERS, O as CALENDAR_LISTENER_REFINERS, P as CALENDAR_OPTION_REFINERS, Q as COMPLEX_OPTION_COMPARATORS, R as VIEW_OPTION_REFINERS, S as DateEnv, U as DateProfileGenerator, W as createEventUi, X as parseBusinessHours, Y as setRef, Z as Interaction, _ as getElSeg, $ as elementClosest, a0 as EventImpl, a1 as listenBySelector, a2 as listenToHoverBySelector, a3 as PureComponent, a4 as buildViewContext, a5 as getUniqueDomId, a6 as parseInteractionSettings, a7 as interactionSettingsStore, a8 as getNow, a9 as CalendarImpl, aa as flushSync, ab as CalendarRoot, ac as RenderId, ad as ensureElHasStyles, ae as applyStyleProp, af as sliceEventStore } from './internal-common.js';\nexport { ag as JsonRequestError } from './internal-common.js';\nimport { createElement, createRef, Fragment, render } from 'preact';\nimport 'preact/compat';\n\nconst globalLocales = [];\n\nconst MINIMAL_RAW_EN_LOCALE = {\n    code: 'en',\n    week: {\n        dow: 0,\n        doy: 4, // 4 days need to be within the year to be considered the first week\n    },\n    direction: 'ltr',\n    buttonText: {\n        prev: 'prev',\n        next: 'next',\n        prevYear: 'prev year',\n        nextYear: 'next year',\n        year: 'year',\n        today: 'today',\n        month: 'month',\n        week: 'week',\n        day: 'day',\n        list: 'list',\n    },\n    weekText: 'W',\n    weekTextLong: 'Week',\n    closeHint: 'Close',\n    timeHint: 'Time',\n    eventHint: 'Event',\n    allDayText: 'all-day',\n    moreLinkText: 'more',\n    noEventsText: 'No events to display',\n};\nconst RAW_EN_LOCALE = Object.assign(Object.assign({}, MINIMAL_RAW_EN_LOCALE), { \n    // Includes things we don't want other locales to inherit,\n    // things that derive from other translatable strings.\n    buttonHints: {\n        prev: 'Previous $0',\n        next: 'Next $0',\n        today(buttonText, unit) {\n            return (unit === 'day')\n                ? 'Today'\n                : `This ${buttonText}`;\n        },\n    }, viewHint: '$0 view', navLinkHint: 'Go to $0', moreLinkHint(eventCnt) {\n        return `Show ${eventCnt} more event${eventCnt === 1 ? '' : 's'}`;\n    } });\nfunction organizeRawLocales(explicitRawLocales) {\n    let defaultCode = explicitRawLocales.length > 0 ? explicitRawLocales[0].code : 'en';\n    let allRawLocales = globalLocales.concat(explicitRawLocales);\n    let rawLocaleMap = {\n        en: RAW_EN_LOCALE,\n    };\n    for (let rawLocale of allRawLocales) {\n        rawLocaleMap[rawLocale.code] = rawLocale;\n    }\n    return {\n        map: rawLocaleMap,\n        defaultCode,\n    };\n}\nfunction buildLocale(inputSingular, available) {\n    if (typeof inputSingular === 'object' && !Array.isArray(inputSingular)) {\n        return parseLocale(inputSingular.code, [inputSingular.code], inputSingular);\n    }\n    return queryLocale(inputSingular, available);\n}\nfunction queryLocale(codeArg, available) {\n    let codes = [].concat(codeArg || []); // will convert to array\n    let raw = queryRawLocale(codes, available) || RAW_EN_LOCALE;\n    return parseLocale(codeArg, codes, raw);\n}\nfunction queryRawLocale(codes, available) {\n    for (let i = 0; i < codes.length; i += 1) {\n        let parts = codes[i].toLocaleLowerCase().split('-');\n        for (let j = parts.length; j > 0; j -= 1) {\n            let simpleId = parts.slice(0, j).join('-');\n            if (available[simpleId]) {\n                return available[simpleId];\n            }\n        }\n    }\n    return null;\n}\nfunction parseLocale(codeArg, codes, raw) {\n    let merged = mergeProps([MINIMAL_RAW_EN_LOCALE, raw], ['buttonText']);\n    delete merged.code; // don't want this part of the options\n    let { week } = merged;\n    delete merged.week;\n    return {\n        codeArg,\n        codes,\n        week,\n        simpleNumberFormat: new Intl.NumberFormat(codeArg),\n        options: merged,\n    };\n}\n\n// TODO: easier way to add new hooks? need to update a million things\nfunction createPlugin(input) {\n    return {\n        id: guid(),\n        name: input.name,\n        premiumReleaseDate: input.premiumReleaseDate ? new Date(input.premiumReleaseDate) : undefined,\n        deps: input.deps || [],\n        reducers: input.reducers || [],\n        isLoadingFuncs: input.isLoadingFuncs || [],\n        contextInit: [].concat(input.contextInit || []),\n        eventRefiners: input.eventRefiners || {},\n        eventDefMemberAdders: input.eventDefMemberAdders || [],\n        eventSourceRefiners: input.eventSourceRefiners || {},\n        isDraggableTransformers: input.isDraggableTransformers || [],\n        eventDragMutationMassagers: input.eventDragMutationMassagers || [],\n        eventDefMutationAppliers: input.eventDefMutationAppliers || [],\n        dateSelectionTransformers: input.dateSelectionTransformers || [],\n        datePointTransforms: input.datePointTransforms || [],\n        dateSpanTransforms: input.dateSpanTransforms || [],\n        views: input.views || {},\n        viewPropsTransformers: input.viewPropsTransformers || [],\n        isPropsValid: input.isPropsValid || null,\n        externalDefTransforms: input.externalDefTransforms || [],\n        viewContainerAppends: input.viewContainerAppends || [],\n        eventDropTransformers: input.eventDropTransformers || [],\n        componentInteractions: input.componentInteractions || [],\n        calendarInteractions: input.calendarInteractions || [],\n        themeClasses: input.themeClasses || {},\n        eventSourceDefs: input.eventSourceDefs || [],\n        cmdFormatter: input.cmdFormatter,\n        recurringTypes: input.recurringTypes || [],\n        namedTimeZonedImpl: input.namedTimeZonedImpl,\n        initialView: input.initialView || '',\n        elementDraggingImpl: input.elementDraggingImpl,\n        optionChangeHandlers: input.optionChangeHandlers || {},\n        scrollGridImpl: input.scrollGridImpl || null,\n        listenerRefiners: input.listenerRefiners || {},\n        optionRefiners: input.optionRefiners || {},\n        propSetHandlers: input.propSetHandlers || {},\n    };\n}\nfunction buildPluginHooks(pluginDefs, globalDefs) {\n    let currentPluginIds = {};\n    let hooks = {\n        premiumReleaseDate: undefined,\n        reducers: [],\n        isLoadingFuncs: [],\n        contextInit: [],\n        eventRefiners: {},\n        eventDefMemberAdders: [],\n        eventSourceRefiners: {},\n        isDraggableTransformers: [],\n        eventDragMutationMassagers: [],\n        eventDefMutationAppliers: [],\n        dateSelectionTransformers: [],\n        datePointTransforms: [],\n        dateSpanTransforms: [],\n        views: {},\n        viewPropsTransformers: [],\n        isPropsValid: null,\n        externalDefTransforms: [],\n        viewContainerAppends: [],\n        eventDropTransformers: [],\n        componentInteractions: [],\n        calendarInteractions: [],\n        themeClasses: {},\n        eventSourceDefs: [],\n        cmdFormatter: null,\n        recurringTypes: [],\n        namedTimeZonedImpl: null,\n        initialView: '',\n        elementDraggingImpl: null,\n        optionChangeHandlers: {},\n        scrollGridImpl: null,\n        listenerRefiners: {},\n        optionRefiners: {},\n        propSetHandlers: {},\n    };\n    function addDefs(defs) {\n        for (let def of defs) {\n            const pluginName = def.name;\n            const currentId = currentPluginIds[pluginName];\n            if (currentId === undefined) {\n                currentPluginIds[pluginName] = def.id;\n                addDefs(def.deps);\n                hooks = combineHooks(hooks, def);\n            }\n            else if (currentId !== def.id) {\n                // different ID than the one already added\n                console.warn(`Duplicate plugin '${pluginName}'`);\n            }\n        }\n    }\n    if (pluginDefs) {\n        addDefs(pluginDefs);\n    }\n    addDefs(globalDefs);\n    return hooks;\n}\nfunction buildBuildPluginHooks() {\n    let currentOverrideDefs = [];\n    let currentGlobalDefs = [];\n    let currentHooks;\n    return (overrideDefs, globalDefs) => {\n        if (!currentHooks || !isArraysEqual(overrideDefs, currentOverrideDefs) || !isArraysEqual(globalDefs, currentGlobalDefs)) {\n            currentHooks = buildPluginHooks(overrideDefs, globalDefs);\n        }\n        currentOverrideDefs = overrideDefs;\n        currentGlobalDefs = globalDefs;\n        return currentHooks;\n    };\n}\nfunction combineHooks(hooks0, hooks1) {\n    return {\n        premiumReleaseDate: compareOptionalDates(hooks0.premiumReleaseDate, hooks1.premiumReleaseDate),\n        reducers: hooks0.reducers.concat(hooks1.reducers),\n        isLoadingFuncs: hooks0.isLoadingFuncs.concat(hooks1.isLoadingFuncs),\n        contextInit: hooks0.contextInit.concat(hooks1.contextInit),\n        eventRefiners: Object.assign(Object.assign({}, hooks0.eventRefiners), hooks1.eventRefiners),\n        eventDefMemberAdders: hooks0.eventDefMemberAdders.concat(hooks1.eventDefMemberAdders),\n        eventSourceRefiners: Object.assign(Object.assign({}, hooks0.eventSourceRefiners), hooks1.eventSourceRefiners),\n        isDraggableTransformers: hooks0.isDraggableTransformers.concat(hooks1.isDraggableTransformers),\n        eventDragMutationMassagers: hooks0.eventDragMutationMassagers.concat(hooks1.eventDragMutationMassagers),\n        eventDefMutationAppliers: hooks0.eventDefMutationAppliers.concat(hooks1.eventDefMutationAppliers),\n        dateSelectionTransformers: hooks0.dateSelectionTransformers.concat(hooks1.dateSelectionTransformers),\n        datePointTransforms: hooks0.datePointTransforms.concat(hooks1.datePointTransforms),\n        dateSpanTransforms: hooks0.dateSpanTransforms.concat(hooks1.dateSpanTransforms),\n        views: Object.assign(Object.assign({}, hooks0.views), hooks1.views),\n        viewPropsTransformers: hooks0.viewPropsTransformers.concat(hooks1.viewPropsTransformers),\n        isPropsValid: hooks1.isPropsValid || hooks0.isPropsValid,\n        externalDefTransforms: hooks0.externalDefTransforms.concat(hooks1.externalDefTransforms),\n        viewContainerAppends: hooks0.viewContainerAppends.concat(hooks1.viewContainerAppends),\n        eventDropTransformers: hooks0.eventDropTransformers.concat(hooks1.eventDropTransformers),\n        calendarInteractions: hooks0.calendarInteractions.concat(hooks1.calendarInteractions),\n        componentInteractions: hooks0.componentInteractions.concat(hooks1.componentInteractions),\n        themeClasses: Object.assign(Object.assign({}, hooks0.themeClasses), hooks1.themeClasses),\n        eventSourceDefs: hooks0.eventSourceDefs.concat(hooks1.eventSourceDefs),\n        cmdFormatter: hooks1.cmdFormatter || hooks0.cmdFormatter,\n        recurringTypes: hooks0.recurringTypes.concat(hooks1.recurringTypes),\n        namedTimeZonedImpl: hooks1.namedTimeZonedImpl || hooks0.namedTimeZonedImpl,\n        initialView: hooks0.initialView || hooks1.initialView,\n        elementDraggingImpl: hooks0.elementDraggingImpl || hooks1.elementDraggingImpl,\n        optionChangeHandlers: Object.assign(Object.assign({}, hooks0.optionChangeHandlers), hooks1.optionChangeHandlers),\n        scrollGridImpl: hooks1.scrollGridImpl || hooks0.scrollGridImpl,\n        listenerRefiners: Object.assign(Object.assign({}, hooks0.listenerRefiners), hooks1.listenerRefiners),\n        optionRefiners: Object.assign(Object.assign({}, hooks0.optionRefiners), hooks1.optionRefiners),\n        propSetHandlers: Object.assign(Object.assign({}, hooks0.propSetHandlers), hooks1.propSetHandlers),\n    };\n}\nfunction compareOptionalDates(date0, date1) {\n    if (date0 === undefined) {\n        return date1;\n    }\n    if (date1 === undefined) {\n        return date0;\n    }\n    return new Date(Math.max(date0.valueOf(), date1.valueOf()));\n}\n\nclass StandardTheme extends Theme {\n}\nStandardTheme.prototype.classes = {\n    root: 'fc-theme-standard',\n    tableCellShaded: 'fc-cell-shaded',\n    buttonGroup: 'fc-button-group',\n    button: 'fc-button fc-button-primary',\n    buttonActive: 'fc-button-active',\n};\nStandardTheme.prototype.baseIconClass = 'fc-icon';\nStandardTheme.prototype.iconClasses = {\n    close: 'fc-icon-x',\n    prev: 'fc-icon-chevron-left',\n    next: 'fc-icon-chevron-right',\n    prevYear: 'fc-icon-chevrons-left',\n    nextYear: 'fc-icon-chevrons-right',\n};\nStandardTheme.prototype.rtlIconClasses = {\n    prev: 'fc-icon-chevron-right',\n    next: 'fc-icon-chevron-left',\n    prevYear: 'fc-icon-chevrons-right',\n    nextYear: 'fc-icon-chevrons-left',\n};\nStandardTheme.prototype.iconOverrideOption = 'buttonIcons'; // TODO: make TS-friendly\nStandardTheme.prototype.iconOverrideCustomButtonOption = 'icon';\nStandardTheme.prototype.iconOverridePrefix = 'fc-icon-';\n\nfunction compileViewDefs(defaultConfigs, overrideConfigs) {\n    let hash = {};\n    let viewType;\n    for (viewType in defaultConfigs) {\n        ensureViewDef(viewType, hash, defaultConfigs, overrideConfigs);\n    }\n    for (viewType in overrideConfigs) {\n        ensureViewDef(viewType, hash, defaultConfigs, overrideConfigs);\n    }\n    return hash;\n}\nfunction ensureViewDef(viewType, hash, defaultConfigs, overrideConfigs) {\n    if (hash[viewType]) {\n        return hash[viewType];\n    }\n    let viewDef = buildViewDef(viewType, hash, defaultConfigs, overrideConfigs);\n    if (viewDef) {\n        hash[viewType] = viewDef;\n    }\n    return viewDef;\n}\nfunction buildViewDef(viewType, hash, defaultConfigs, overrideConfigs) {\n    let defaultConfig = defaultConfigs[viewType];\n    let overrideConfig = overrideConfigs[viewType];\n    let queryProp = (name) => ((defaultConfig && defaultConfig[name] !== null) ? defaultConfig[name] :\n        ((overrideConfig && overrideConfig[name] !== null) ? overrideConfig[name] : null));\n    let theComponent = queryProp('component');\n    let superType = queryProp('superType');\n    let superDef = null;\n    if (superType) {\n        if (superType === viewType) {\n            throw new Error('Can\\'t have a custom view type that references itself');\n        }\n        superDef = ensureViewDef(superType, hash, defaultConfigs, overrideConfigs);\n    }\n    if (!theComponent && superDef) {\n        theComponent = superDef.component;\n    }\n    if (!theComponent) {\n        return null; // don't throw a warning, might be settings for a single-unit view\n    }\n    return {\n        type: viewType,\n        component: theComponent,\n        defaults: Object.assign(Object.assign({}, (superDef ? superDef.defaults : {})), (defaultConfig ? defaultConfig.rawOptions : {})),\n        overrides: Object.assign(Object.assign({}, (superDef ? superDef.overrides : {})), (overrideConfig ? overrideConfig.rawOptions : {})),\n    };\n}\n\nfunction parseViewConfigs(inputs) {\n    return mapHash(inputs, parseViewConfig);\n}\nfunction parseViewConfig(input) {\n    let rawOptions = typeof input === 'function' ?\n        { component: input } :\n        input;\n    let { component } = rawOptions;\n    if (rawOptions.content) {\n        // TODO: remove content/classNames/didMount/etc from options?\n        component = createViewHookComponent(rawOptions);\n    }\n    else if (component && !(component.prototype instanceof BaseComponent)) {\n        // WHY?: people were using `component` property for `content`\n        // TODO: converge on one setting name\n        component = createViewHookComponent(Object.assign(Object.assign({}, rawOptions), { content: component }));\n    }\n    return {\n        superType: rawOptions.type,\n        component: component,\n        rawOptions, // includes type and component too :(\n    };\n}\nfunction createViewHookComponent(options) {\n    return (viewProps) => (createElement(ViewContextType.Consumer, null, (context) => (createElement(ContentContainer, { elTag: \"div\", elClasses: buildViewClassNames(context.viewSpec), renderProps: Object.assign(Object.assign({}, viewProps), { nextDayThreshold: context.options.nextDayThreshold }), generatorName: undefined, customGenerator: options.content, classNameGenerator: options.classNames, didMount: options.didMount, willUnmount: options.willUnmount }))));\n}\n\nfunction buildViewSpecs(defaultInputs, optionOverrides, dynamicOptionOverrides, localeDefaults) {\n    let defaultConfigs = parseViewConfigs(defaultInputs);\n    let overrideConfigs = parseViewConfigs(optionOverrides.views);\n    let viewDefs = compileViewDefs(defaultConfigs, overrideConfigs);\n    return mapHash(viewDefs, (viewDef) => buildViewSpec(viewDef, overrideConfigs, optionOverrides, dynamicOptionOverrides, localeDefaults));\n}\nfunction buildViewSpec(viewDef, overrideConfigs, optionOverrides, dynamicOptionOverrides, localeDefaults) {\n    let durationInput = viewDef.overrides.duration ||\n        viewDef.defaults.duration ||\n        dynamicOptionOverrides.duration ||\n        optionOverrides.duration;\n    let duration = null;\n    let durationUnit = '';\n    let singleUnit = '';\n    let singleUnitOverrides = {};\n    if (durationInput) {\n        duration = createDurationCached(durationInput);\n        if (duration) { // valid?\n            let denom = greatestDurationDenominator(duration);\n            durationUnit = denom.unit;\n            if (denom.value === 1) {\n                singleUnit = durationUnit;\n                singleUnitOverrides = overrideConfigs[durationUnit] ? overrideConfigs[durationUnit].rawOptions : {};\n            }\n        }\n    }\n    let queryButtonText = (optionsSubset) => {\n        let buttonTextMap = optionsSubset.buttonText || {};\n        let buttonTextKey = viewDef.defaults.buttonTextKey;\n        if (buttonTextKey != null && buttonTextMap[buttonTextKey] != null) {\n            return buttonTextMap[buttonTextKey];\n        }\n        if (buttonTextMap[viewDef.type] != null) {\n            return buttonTextMap[viewDef.type];\n        }\n        if (buttonTextMap[singleUnit] != null) {\n            return buttonTextMap[singleUnit];\n        }\n        return null;\n    };\n    let queryButtonTitle = (optionsSubset) => {\n        let buttonHints = optionsSubset.buttonHints || {};\n        let buttonKey = viewDef.defaults.buttonTextKey; // use same key as text\n        if (buttonKey != null && buttonHints[buttonKey] != null) {\n            return buttonHints[buttonKey];\n        }\n        if (buttonHints[viewDef.type] != null) {\n            return buttonHints[viewDef.type];\n        }\n        if (buttonHints[singleUnit] != null) {\n            return buttonHints[singleUnit];\n        }\n        return null;\n    };\n    return {\n        type: viewDef.type,\n        component: viewDef.component,\n        duration,\n        durationUnit,\n        singleUnit,\n        optionDefaults: viewDef.defaults,\n        optionOverrides: Object.assign(Object.assign({}, singleUnitOverrides), viewDef.overrides),\n        buttonTextOverride: queryButtonText(dynamicOptionOverrides) ||\n            queryButtonText(optionOverrides) || // constructor-specified buttonText lookup hash takes precedence\n            viewDef.overrides.buttonText,\n        buttonTextDefault: queryButtonText(localeDefaults) ||\n            viewDef.defaults.buttonText ||\n            queryButtonText(BASE_OPTION_DEFAULTS) ||\n            viewDef.type,\n        // not DRY\n        buttonTitleOverride: queryButtonTitle(dynamicOptionOverrides) ||\n            queryButtonTitle(optionOverrides) ||\n            viewDef.overrides.buttonHint,\n        buttonTitleDefault: queryButtonTitle(localeDefaults) ||\n            viewDef.defaults.buttonHint ||\n            queryButtonTitle(BASE_OPTION_DEFAULTS),\n        // will eventually fall back to buttonText\n    };\n}\n// hack to get memoization working\nlet durationInputMap = {};\nfunction createDurationCached(durationInput) {\n    let json = JSON.stringify(durationInput);\n    let res = durationInputMap[json];\n    if (res === undefined) {\n        res = createDuration(durationInput);\n        durationInputMap[json] = res;\n    }\n    return res;\n}\n\nfunction reduceViewType(viewType, action) {\n    switch (action.type) {\n        case 'CHANGE_VIEW_TYPE':\n            viewType = action.viewType;\n    }\n    return viewType;\n}\n\nfunction reduceDynamicOptionOverrides(dynamicOptionOverrides, action) {\n    switch (action.type) {\n        case 'SET_OPTION':\n            return Object.assign(Object.assign({}, dynamicOptionOverrides), { [action.optionName]: action.rawOptionValue });\n        default:\n            return dynamicOptionOverrides;\n    }\n}\n\nfunction reduceDateProfile(currentDateProfile, action, currentDate, dateProfileGenerator) {\n    let dp;\n    switch (action.type) {\n        case 'CHANGE_VIEW_TYPE':\n            return dateProfileGenerator.build(action.dateMarker || currentDate);\n        case 'CHANGE_DATE':\n            return dateProfileGenerator.build(action.dateMarker);\n        case 'PREV':\n            dp = dateProfileGenerator.buildPrev(currentDateProfile, currentDate);\n            if (dp.isValid) {\n                return dp;\n            }\n            break;\n        case 'NEXT':\n            dp = dateProfileGenerator.buildNext(currentDateProfile, currentDate);\n            if (dp.isValid) {\n                return dp;\n            }\n            break;\n    }\n    return currentDateProfile;\n}\n\nfunction initEventSources(calendarOptions, dateProfile, context) {\n    let activeRange = dateProfile ? dateProfile.activeRange : null;\n    return addSources({}, parseInitialSources(calendarOptions, context), activeRange, context);\n}\nfunction reduceEventSources(eventSources, action, dateProfile, context) {\n    let activeRange = dateProfile ? dateProfile.activeRange : null; // need this check?\n    switch (action.type) {\n        case 'ADD_EVENT_SOURCES': // already parsed\n            return addSources(eventSources, action.sources, activeRange, context);\n        case 'REMOVE_EVENT_SOURCE':\n            return removeSource(eventSources, action.sourceId);\n        case 'PREV': // TODO: how do we track all actions that affect dateProfile :(\n        case 'NEXT':\n        case 'CHANGE_DATE':\n        case 'CHANGE_VIEW_TYPE':\n            if (dateProfile) {\n                return fetchDirtySources(eventSources, activeRange, context);\n            }\n            return eventSources;\n        case 'FETCH_EVENT_SOURCES':\n            return fetchSourcesByIds(eventSources, action.sourceIds ? // why no type?\n                arrayToHash(action.sourceIds) :\n                excludeStaticSources(eventSources, context), activeRange, action.isRefetch || false, context);\n        case 'RECEIVE_EVENTS':\n        case 'RECEIVE_EVENT_ERROR':\n            return receiveResponse(eventSources, action.sourceId, action.fetchId, action.fetchRange);\n        case 'REMOVE_ALL_EVENT_SOURCES':\n            return {};\n        default:\n            return eventSources;\n    }\n}\nfunction reduceEventSourcesNewTimeZone(eventSources, dateProfile, context) {\n    let activeRange = dateProfile ? dateProfile.activeRange : null; // need this check?\n    return fetchSourcesByIds(eventSources, excludeStaticSources(eventSources, context), activeRange, true, context);\n}\nfunction computeEventSourcesLoading(eventSources) {\n    for (let sourceId in eventSources) {\n        if (eventSources[sourceId].isFetching) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction addSources(eventSourceHash, sources, fetchRange, context) {\n    let hash = {};\n    for (let source of sources) {\n        hash[source.sourceId] = source;\n    }\n    if (fetchRange) {\n        hash = fetchDirtySources(hash, fetchRange, context);\n    }\n    return Object.assign(Object.assign({}, eventSourceHash), hash);\n}\nfunction removeSource(eventSourceHash, sourceId) {\n    return filterHash(eventSourceHash, (eventSource) => eventSource.sourceId !== sourceId);\n}\nfunction fetchDirtySources(sourceHash, fetchRange, context) {\n    return fetchSourcesByIds(sourceHash, filterHash(sourceHash, (eventSource) => isSourceDirty(eventSource, fetchRange, context)), fetchRange, false, context);\n}\nfunction isSourceDirty(eventSource, fetchRange, context) {\n    if (!doesSourceNeedRange(eventSource, context)) {\n        return !eventSource.latestFetchId;\n    }\n    return !context.options.lazyFetching ||\n        !eventSource.fetchRange ||\n        eventSource.isFetching || // always cancel outdated in-progress fetches\n        fetchRange.start < eventSource.fetchRange.start ||\n        fetchRange.end > eventSource.fetchRange.end;\n}\nfunction fetchSourcesByIds(prevSources, sourceIdHash, fetchRange, isRefetch, context) {\n    let nextSources = {};\n    for (let sourceId in prevSources) {\n        let source = prevSources[sourceId];\n        if (sourceIdHash[sourceId]) {\n            nextSources[sourceId] = fetchSource(source, fetchRange, isRefetch, context);\n        }\n        else {\n            nextSources[sourceId] = source;\n        }\n    }\n    return nextSources;\n}\nfunction fetchSource(eventSource, fetchRange, isRefetch, context) {\n    let { options, calendarApi } = context;\n    let sourceDef = context.pluginHooks.eventSourceDefs[eventSource.sourceDefId];\n    let fetchId = guid();\n    sourceDef.fetch({\n        eventSource,\n        range: fetchRange,\n        isRefetch,\n        context,\n    }, (res) => {\n        let { rawEvents } = res;\n        if (options.eventSourceSuccess) {\n            rawEvents = options.eventSourceSuccess.call(calendarApi, rawEvents, res.response) || rawEvents;\n        }\n        if (eventSource.success) {\n            rawEvents = eventSource.success.call(calendarApi, rawEvents, res.response) || rawEvents;\n        }\n        context.dispatch({\n            type: 'RECEIVE_EVENTS',\n            sourceId: eventSource.sourceId,\n            fetchId,\n            fetchRange,\n            rawEvents,\n        });\n    }, (error) => {\n        let errorHandled = false;\n        if (options.eventSourceFailure) {\n            options.eventSourceFailure.call(calendarApi, error);\n            errorHandled = true;\n        }\n        if (eventSource.failure) {\n            eventSource.failure(error);\n            errorHandled = true;\n        }\n        if (!errorHandled) {\n            console.warn(error.message, error);\n        }\n        context.dispatch({\n            type: 'RECEIVE_EVENT_ERROR',\n            sourceId: eventSource.sourceId,\n            fetchId,\n            fetchRange,\n            error,\n        });\n    });\n    return Object.assign(Object.assign({}, eventSource), { isFetching: true, latestFetchId: fetchId });\n}\nfunction receiveResponse(sourceHash, sourceId, fetchId, fetchRange) {\n    let eventSource = sourceHash[sourceId];\n    if (eventSource && // not already removed\n        fetchId === eventSource.latestFetchId) {\n        return Object.assign(Object.assign({}, sourceHash), { [sourceId]: Object.assign(Object.assign({}, eventSource), { isFetching: false, fetchRange }) });\n    }\n    return sourceHash;\n}\nfunction excludeStaticSources(eventSources, context) {\n    return filterHash(eventSources, (eventSource) => doesSourceNeedRange(eventSource, context));\n}\nfunction parseInitialSources(rawOptions, context) {\n    let refiners = buildEventSourceRefiners(context);\n    let rawSources = [].concat(rawOptions.eventSources || []);\n    let sources = []; // parsed\n    if (rawOptions.initialEvents) {\n        rawSources.unshift(rawOptions.initialEvents);\n    }\n    if (rawOptions.events) {\n        rawSources.unshift(rawOptions.events);\n    }\n    for (let rawSource of rawSources) {\n        let source = parseEventSource(rawSource, context, refiners);\n        if (source) {\n            sources.push(source);\n        }\n    }\n    return sources;\n}\nfunction doesSourceNeedRange(eventSource, context) {\n    let defs = context.pluginHooks.eventSourceDefs;\n    return !defs[eventSource.sourceDefId].ignoreRange;\n}\n\nfunction reduceDateSelection(currentSelection, action) {\n    switch (action.type) {\n        case 'UNSELECT_DATES':\n            return null;\n        case 'SELECT_DATES':\n            return action.selection;\n        default:\n            return currentSelection;\n    }\n}\n\nfunction reduceSelectedEvent(currentInstanceId, action) {\n    switch (action.type) {\n        case 'UNSELECT_EVENT':\n            return '';\n        case 'SELECT_EVENT':\n            return action.eventInstanceId;\n        default:\n            return currentInstanceId;\n    }\n}\n\nfunction reduceEventDrag(currentDrag, action) {\n    let newDrag;\n    switch (action.type) {\n        case 'UNSET_EVENT_DRAG':\n            return null;\n        case 'SET_EVENT_DRAG':\n            newDrag = action.state;\n            return {\n                affectedEvents: newDrag.affectedEvents,\n                mutatedEvents: newDrag.mutatedEvents,\n                isEvent: newDrag.isEvent,\n            };\n        default:\n            return currentDrag;\n    }\n}\n\nfunction reduceEventResize(currentResize, action) {\n    let newResize;\n    switch (action.type) {\n        case 'UNSET_EVENT_RESIZE':\n            return null;\n        case 'SET_EVENT_RESIZE':\n            newResize = action.state;\n            return {\n                affectedEvents: newResize.affectedEvents,\n                mutatedEvents: newResize.mutatedEvents,\n                isEvent: newResize.isEvent,\n            };\n        default:\n            return currentResize;\n    }\n}\n\nfunction parseToolbars(calendarOptions, calendarOptionOverrides, theme, viewSpecs, calendarApi) {\n    let header = calendarOptions.headerToolbar ? parseToolbar(calendarOptions.headerToolbar, calendarOptions, calendarOptionOverrides, theme, viewSpecs, calendarApi) : null;\n    let footer = calendarOptions.footerToolbar ? parseToolbar(calendarOptions.footerToolbar, calendarOptions, calendarOptionOverrides, theme, viewSpecs, calendarApi) : null;\n    return { header, footer };\n}\nfunction parseToolbar(sectionStrHash, calendarOptions, calendarOptionOverrides, theme, viewSpecs, calendarApi) {\n    let sectionWidgets = {};\n    let viewsWithButtons = [];\n    let hasTitle = false;\n    for (let sectionName in sectionStrHash) {\n        let sectionStr = sectionStrHash[sectionName];\n        let sectionRes = parseSection(sectionStr, calendarOptions, calendarOptionOverrides, theme, viewSpecs, calendarApi);\n        sectionWidgets[sectionName] = sectionRes.widgets;\n        viewsWithButtons.push(...sectionRes.viewsWithButtons);\n        hasTitle = hasTitle || sectionRes.hasTitle;\n    }\n    return { sectionWidgets, viewsWithButtons, hasTitle };\n}\n/*\nBAD: querying icons and text here. should be done at render time\n*/\nfunction parseSection(sectionStr, calendarOptions, // defaults+overrides, then refined\ncalendarOptionOverrides, // overrides only!, unrefined :(\ntheme, viewSpecs, calendarApi) {\n    let isRtl = calendarOptions.direction === 'rtl';\n    let calendarCustomButtons = calendarOptions.customButtons || {};\n    let calendarButtonTextOverrides = calendarOptionOverrides.buttonText || {};\n    let calendarButtonText = calendarOptions.buttonText || {};\n    let calendarButtonHintOverrides = calendarOptionOverrides.buttonHints || {};\n    let calendarButtonHints = calendarOptions.buttonHints || {};\n    let sectionSubstrs = sectionStr ? sectionStr.split(' ') : [];\n    let viewsWithButtons = [];\n    let hasTitle = false;\n    let widgets = sectionSubstrs.map((buttonGroupStr) => (buttonGroupStr.split(',').map((buttonName) => {\n        if (buttonName === 'title') {\n            hasTitle = true;\n            return { buttonName };\n        }\n        let customButtonProps;\n        let viewSpec;\n        let buttonClick;\n        let buttonIcon; // only one of these will be set\n        let buttonText; // \"\n        let buttonHint;\n        // ^ for the title=\"\" attribute, for accessibility\n        if ((customButtonProps = calendarCustomButtons[buttonName])) {\n            buttonClick = (ev) => {\n                if (customButtonProps.click) {\n                    customButtonProps.click.call(ev.target, ev, ev.target); // TODO: use Calendar this context?\n                }\n            };\n            (buttonIcon = theme.getCustomButtonIconClass(customButtonProps)) ||\n                (buttonIcon = theme.getIconClass(buttonName, isRtl)) ||\n                (buttonText = customButtonProps.text);\n            buttonHint = customButtonProps.hint || customButtonProps.text;\n        }\n        else if ((viewSpec = viewSpecs[buttonName])) {\n            viewsWithButtons.push(buttonName);\n            buttonClick = () => {\n                calendarApi.changeView(buttonName);\n            };\n            (buttonText = viewSpec.buttonTextOverride) ||\n                (buttonIcon = theme.getIconClass(buttonName, isRtl)) ||\n                (buttonText = viewSpec.buttonTextDefault);\n            let textFallback = viewSpec.buttonTextOverride ||\n                viewSpec.buttonTextDefault;\n            buttonHint = formatWithOrdinals(viewSpec.buttonTitleOverride ||\n                viewSpec.buttonTitleDefault ||\n                calendarOptions.viewHint, [textFallback, buttonName], // view-name = buttonName\n            textFallback);\n        }\n        else if (calendarApi[buttonName]) { // a calendarApi method\n            buttonClick = () => {\n                calendarApi[buttonName]();\n            };\n            (buttonText = calendarButtonTextOverrides[buttonName]) ||\n                (buttonIcon = theme.getIconClass(buttonName, isRtl)) ||\n                (buttonText = calendarButtonText[buttonName]); // everything else is considered default\n            if (buttonName === 'prevYear' || buttonName === 'nextYear') {\n                let prevOrNext = buttonName === 'prevYear' ? 'prev' : 'next';\n                buttonHint = formatWithOrdinals(calendarButtonHintOverrides[prevOrNext] ||\n                    calendarButtonHints[prevOrNext], [\n                    calendarButtonText.year || 'year',\n                    'year',\n                ], calendarButtonText[buttonName]);\n            }\n            else {\n                buttonHint = (navUnit) => formatWithOrdinals(calendarButtonHintOverrides[buttonName] ||\n                    calendarButtonHints[buttonName], [\n                    calendarButtonText[navUnit] || navUnit,\n                    navUnit,\n                ], calendarButtonText[buttonName]);\n            }\n        }\n        return { buttonName, buttonClick, buttonIcon, buttonText, buttonHint };\n    })));\n    return { widgets, viewsWithButtons, hasTitle };\n}\n\n// always represents the current view. otherwise, it'd need to change value every time date changes\nclass ViewImpl {\n    constructor(type, getCurrentData, dateEnv) {\n        this.type = type;\n        this.getCurrentData = getCurrentData;\n        this.dateEnv = dateEnv;\n    }\n    get calendar() {\n        return this.getCurrentData().calendarApi;\n    }\n    get title() {\n        return this.getCurrentData().viewTitle;\n    }\n    get activeStart() {\n        return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.start);\n    }\n    get activeEnd() {\n        return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.end);\n    }\n    get currentStart() {\n        return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.start);\n    }\n    get currentEnd() {\n        return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.end);\n    }\n    getOption(name) {\n        return this.getCurrentData().options[name]; // are the view-specific options\n    }\n}\n\nlet eventSourceDef$2 = {\n    ignoreRange: true,\n    parseMeta(refined) {\n        if (Array.isArray(refined.events)) {\n            return refined.events;\n        }\n        return null;\n    },\n    fetch(arg, successCallback) {\n        successCallback({\n            rawEvents: arg.eventSource.meta,\n        });\n    },\n};\nconst arrayEventSourcePlugin = createPlugin({\n    name: 'array-event-source',\n    eventSourceDefs: [eventSourceDef$2],\n});\n\nlet eventSourceDef$1 = {\n    parseMeta(refined) {\n        if (typeof refined.events === 'function') {\n            return refined.events;\n        }\n        return null;\n    },\n    fetch(arg, successCallback, errorCallback) {\n        const { dateEnv } = arg.context;\n        const func = arg.eventSource.meta;\n        unpromisify(func.bind(null, buildRangeApiWithTimeZone(arg.range, dateEnv)), (rawEvents) => successCallback({ rawEvents }), errorCallback);\n    },\n};\nconst funcEventSourcePlugin = createPlugin({\n    name: 'func-event-source',\n    eventSourceDefs: [eventSourceDef$1],\n});\n\nconst JSON_FEED_EVENT_SOURCE_REFINERS = {\n    method: String,\n    extraParams: identity,\n    startParam: String,\n    endParam: String,\n    timeZoneParam: String,\n};\n\nlet eventSourceDef = {\n    parseMeta(refined) {\n        if (refined.url && (refined.format === 'json' || !refined.format)) {\n            return {\n                url: refined.url,\n                format: 'json',\n                method: (refined.method || 'GET').toUpperCase(),\n                extraParams: refined.extraParams,\n                startParam: refined.startParam,\n                endParam: refined.endParam,\n                timeZoneParam: refined.timeZoneParam,\n            };\n        }\n        return null;\n    },\n    fetch(arg, successCallback, errorCallback) {\n        const { meta } = arg.eventSource;\n        const requestParams = buildRequestParams(meta, arg.range, arg.context);\n        requestJson(meta.method, meta.url, requestParams).then(([rawEvents, response]) => {\n            successCallback({ rawEvents, response });\n        }, errorCallback);\n    },\n};\nconst jsonFeedEventSourcePlugin = createPlugin({\n    name: 'json-event-source',\n    eventSourceRefiners: JSON_FEED_EVENT_SOURCE_REFINERS,\n    eventSourceDefs: [eventSourceDef],\n});\nfunction buildRequestParams(meta, range, context) {\n    let { dateEnv, options } = context;\n    let startParam;\n    let endParam;\n    let timeZoneParam;\n    let customRequestParams;\n    let params = {};\n    startParam = meta.startParam;\n    if (startParam == null) {\n        startParam = options.startParam;\n    }\n    endParam = meta.endParam;\n    if (endParam == null) {\n        endParam = options.endParam;\n    }\n    timeZoneParam = meta.timeZoneParam;\n    if (timeZoneParam == null) {\n        timeZoneParam = options.timeZoneParam;\n    }\n    // retrieve any outbound GET/POST data from the options\n    if (typeof meta.extraParams === 'function') {\n        // supplied as a function that returns a key/value object\n        customRequestParams = meta.extraParams();\n    }\n    else {\n        // probably supplied as a straight key/value object\n        customRequestParams = meta.extraParams || {};\n    }\n    Object.assign(params, customRequestParams);\n    params[startParam] = dateEnv.formatIso(range.start);\n    params[endParam] = dateEnv.formatIso(range.end);\n    if (dateEnv.timeZone !== 'local') {\n        params[timeZoneParam] = dateEnv.timeZone;\n    }\n    return params;\n}\n\nconst SIMPLE_RECURRING_REFINERS = {\n    daysOfWeek: identity,\n    startTime: createDuration,\n    endTime: createDuration,\n    duration: createDuration,\n    startRecur: identity,\n    endRecur: identity,\n};\n\nlet recurring = {\n    parse(refined, dateEnv) {\n        if (refined.daysOfWeek || refined.startTime || refined.endTime || refined.startRecur || refined.endRecur) {\n            let recurringData = {\n                daysOfWeek: refined.daysOfWeek || null,\n                startTime: refined.startTime || null,\n                endTime: refined.endTime || null,\n                startRecur: refined.startRecur ? dateEnv.createMarker(refined.startRecur) : null,\n                endRecur: refined.endRecur ? dateEnv.createMarker(refined.endRecur) : null,\n            };\n            let duration;\n            if (refined.duration) {\n                duration = refined.duration;\n            }\n            if (!duration && refined.startTime && refined.endTime) {\n                duration = subtractDurations(refined.endTime, refined.startTime);\n            }\n            return {\n                allDayGuess: Boolean(!refined.startTime && !refined.endTime),\n                duration,\n                typeData: recurringData, // doesn't need endTime anymore but oh well\n            };\n        }\n        return null;\n    },\n    expand(typeData, framingRange, dateEnv) {\n        let clippedFramingRange = intersectRanges(framingRange, { start: typeData.startRecur, end: typeData.endRecur });\n        if (clippedFramingRange) {\n            return expandRanges(typeData.daysOfWeek, typeData.startTime, clippedFramingRange, dateEnv);\n        }\n        return [];\n    },\n};\nconst simpleRecurringEventsPlugin = createPlugin({\n    name: 'simple-recurring-event',\n    recurringTypes: [recurring],\n    eventRefiners: SIMPLE_RECURRING_REFINERS,\n});\nfunction expandRanges(daysOfWeek, startTime, framingRange, dateEnv) {\n    let dowHash = daysOfWeek ? arrayToHash(daysOfWeek) : null;\n    let dayMarker = startOfDay(framingRange.start);\n    let endMarker = framingRange.end;\n    let instanceStarts = [];\n    while (dayMarker < endMarker) {\n        let instanceStart;\n        // if everyday, or this particular day-of-week\n        if (!dowHash || dowHash[dayMarker.getUTCDay()]) {\n            if (startTime) {\n                instanceStart = dateEnv.add(dayMarker, startTime);\n            }\n            else {\n                instanceStart = dayMarker;\n            }\n            instanceStarts.push(instanceStart);\n        }\n        dayMarker = addDays(dayMarker, 1);\n    }\n    return instanceStarts;\n}\n\nconst changeHandlerPlugin = createPlugin({\n    name: 'change-handler',\n    optionChangeHandlers: {\n        events(events, context) {\n            handleEventSources([events], context);\n        },\n        eventSources: handleEventSources,\n    },\n});\n/*\nBUG: if `event` was supplied, all previously-given `eventSources` will be wiped out\n*/\nfunction handleEventSources(inputs, context) {\n    let unfoundSources = hashValuesToArray(context.getCurrentData().eventSources);\n    if (unfoundSources.length === 1 &&\n        inputs.length === 1 &&\n        Array.isArray(unfoundSources[0]._raw) &&\n        Array.isArray(inputs[0])) {\n        context.dispatch({\n            type: 'RESET_RAW_EVENTS',\n            sourceId: unfoundSources[0].sourceId,\n            rawEvents: inputs[0],\n        });\n        return;\n    }\n    let newInputs = [];\n    for (let input of inputs) {\n        let inputFound = false;\n        for (let i = 0; i < unfoundSources.length; i += 1) {\n            if (unfoundSources[i]._raw === input) {\n                unfoundSources.splice(i, 1); // delete\n                inputFound = true;\n                break;\n            }\n        }\n        if (!inputFound) {\n            newInputs.push(input);\n        }\n    }\n    for (let unfoundSource of unfoundSources) {\n        context.dispatch({\n            type: 'REMOVE_EVENT_SOURCE',\n            sourceId: unfoundSource.sourceId,\n        });\n    }\n    for (let newInput of newInputs) {\n        context.calendarApi.addEventSource(newInput);\n    }\n}\n\nfunction handleDateProfile(dateProfile, context) {\n    context.emitter.trigger('datesSet', Object.assign(Object.assign({}, buildRangeApiWithTimeZone(dateProfile.activeRange, context.dateEnv)), { view: context.viewApi }));\n}\n\nfunction handleEventStore(eventStore, context) {\n    let { emitter } = context;\n    if (emitter.hasHandlers('eventsSet')) {\n        emitter.trigger('eventsSet', buildEventApis(eventStore, context));\n    }\n}\n\n/*\nthis array is exposed on the root namespace so that UMD plugins can add to it.\nsee the rollup-bundles script.\n*/\nconst globalPlugins = [\n    arrayEventSourcePlugin,\n    funcEventSourcePlugin,\n    jsonFeedEventSourcePlugin,\n    simpleRecurringEventsPlugin,\n    changeHandlerPlugin,\n    createPlugin({\n        name: 'misc',\n        isLoadingFuncs: [\n            (state) => computeEventSourcesLoading(state.eventSources),\n        ],\n        propSetHandlers: {\n            dateProfile: handleDateProfile,\n            eventStore: handleEventStore,\n        },\n    }),\n];\n\nclass TaskRunner {\n    constructor(runTaskOption, drainedOption) {\n        this.runTaskOption = runTaskOption;\n        this.drainedOption = drainedOption;\n        this.queue = [];\n        this.delayedRunner = new DelayedRunner(this.drain.bind(this));\n    }\n    request(task, delay) {\n        this.queue.push(task);\n        this.delayedRunner.request(delay);\n    }\n    pause(scope) {\n        this.delayedRunner.pause(scope);\n    }\n    resume(scope, force) {\n        this.delayedRunner.resume(scope, force);\n    }\n    drain() {\n        let { queue } = this;\n        while (queue.length) {\n            let completedTasks = [];\n            let task;\n            while ((task = queue.shift())) {\n                this.runTask(task);\n                completedTasks.push(task);\n            }\n            this.drained(completedTasks);\n        } // keep going, in case new tasks were added in the drained handler\n    }\n    runTask(task) {\n        if (this.runTaskOption) {\n            this.runTaskOption(task);\n        }\n    }\n    drained(completedTasks) {\n        if (this.drainedOption) {\n            this.drainedOption(completedTasks);\n        }\n    }\n}\n\n// Computes what the title at the top of the calendarApi should be for this view\nfunction buildTitle(dateProfile, viewOptions, dateEnv) {\n    let range;\n    // for views that span a large unit of time, show the proper interval, ignoring stray days before and after\n    if (/^(year|month)$/.test(dateProfile.currentRangeUnit)) {\n        range = dateProfile.currentRange;\n    }\n    else { // for day units or smaller, use the actual day range\n        range = dateProfile.activeRange;\n    }\n    return dateEnv.formatRange(range.start, range.end, createFormatter(viewOptions.titleFormat || buildTitleFormat(dateProfile)), {\n        isEndExclusive: dateProfile.isRangeAllDay,\n        defaultSeparator: viewOptions.titleRangeSeparator,\n    });\n}\n// Generates the format string that should be used to generate the title for the current date range.\n// Attempts to compute the most appropriate format if not explicitly specified with `titleFormat`.\nfunction buildTitleFormat(dateProfile) {\n    let { currentRangeUnit } = dateProfile;\n    if (currentRangeUnit === 'year') {\n        return { year: 'numeric' };\n    }\n    if (currentRangeUnit === 'month') {\n        return { year: 'numeric', month: 'long' }; // like \"September 2014\"\n    }\n    let days = diffWholeDays(dateProfile.currentRange.start, dateProfile.currentRange.end);\n    if (days !== null && days > 1) {\n        // multi-day range. shorter, like \"Sep 9 - 10 2014\"\n        return { year: 'numeric', month: 'short', day: 'numeric' };\n    }\n    // one day. longer, like \"September 9 2014\"\n    return { year: 'numeric', month: 'long', day: 'numeric' };\n}\n\n// in future refactor, do the redux-style function(state=initial) for initial-state\n// also, whatever is happening in constructor, have it happen in action queue too\nclass CalendarDataManager {\n    constructor(props) {\n        this.computeCurrentViewData = memoize(this._computeCurrentViewData);\n        this.organizeRawLocales = memoize(organizeRawLocales);\n        this.buildLocale = memoize(buildLocale);\n        this.buildPluginHooks = buildBuildPluginHooks();\n        this.buildDateEnv = memoize(buildDateEnv$1);\n        this.buildTheme = memoize(buildTheme);\n        this.parseToolbars = memoize(parseToolbars);\n        this.buildViewSpecs = memoize(buildViewSpecs);\n        this.buildDateProfileGenerator = memoizeObjArg(buildDateProfileGenerator);\n        this.buildViewApi = memoize(buildViewApi);\n        this.buildViewUiProps = memoizeObjArg(buildViewUiProps);\n        this.buildEventUiBySource = memoize(buildEventUiBySource, isPropsEqual);\n        this.buildEventUiBases = memoize(buildEventUiBases);\n        this.parseContextBusinessHours = memoizeObjArg(parseContextBusinessHours);\n        this.buildTitle = memoize(buildTitle);\n        this.emitter = new Emitter();\n        this.actionRunner = new TaskRunner(this._handleAction.bind(this), this.updateData.bind(this));\n        this.currentCalendarOptionsInput = {};\n        this.currentCalendarOptionsRefined = {};\n        this.currentViewOptionsInput = {};\n        this.currentViewOptionsRefined = {};\n        this.currentCalendarOptionsRefiners = {};\n        this.optionsForRefining = [];\n        this.optionsForHandling = [];\n        this.getCurrentData = () => this.data;\n        this.dispatch = (action) => {\n            this.actionRunner.request(action); // protects against recursive calls to _handleAction\n        };\n        this.props = props;\n        this.actionRunner.pause();\n        let dynamicOptionOverrides = {};\n        let optionsData = this.computeOptionsData(props.optionOverrides, dynamicOptionOverrides, props.calendarApi);\n        let currentViewType = optionsData.calendarOptions.initialView || optionsData.pluginHooks.initialView;\n        let currentViewData = this.computeCurrentViewData(currentViewType, optionsData, props.optionOverrides, dynamicOptionOverrides);\n        // wire things up\n        // TODO: not DRY\n        props.calendarApi.currentDataManager = this;\n        this.emitter.setThisContext(props.calendarApi);\n        this.emitter.setOptions(currentViewData.options);\n        let currentDate = getInitialDate(optionsData.calendarOptions, optionsData.dateEnv);\n        let dateProfile = currentViewData.dateProfileGenerator.build(currentDate);\n        if (!rangeContainsMarker(dateProfile.activeRange, currentDate)) {\n            currentDate = dateProfile.currentRange.start;\n        }\n        let calendarContext = {\n            dateEnv: optionsData.dateEnv,\n            options: optionsData.calendarOptions,\n            pluginHooks: optionsData.pluginHooks,\n            calendarApi: props.calendarApi,\n            dispatch: this.dispatch,\n            emitter: this.emitter,\n            getCurrentData: this.getCurrentData,\n        };\n        // needs to be after setThisContext\n        for (let callback of optionsData.pluginHooks.contextInit) {\n            callback(calendarContext);\n        }\n        // NOT DRY\n        let eventSources = initEventSources(optionsData.calendarOptions, dateProfile, calendarContext);\n        let initialState = {\n            dynamicOptionOverrides,\n            currentViewType,\n            currentDate,\n            dateProfile,\n            businessHours: this.parseContextBusinessHours(calendarContext),\n            eventSources,\n            eventUiBases: {},\n            eventStore: createEmptyEventStore(),\n            renderableEventStore: createEmptyEventStore(),\n            dateSelection: null,\n            eventSelection: '',\n            eventDrag: null,\n            eventResize: null,\n            selectionConfig: this.buildViewUiProps(calendarContext).selectionConfig,\n        };\n        let contextAndState = Object.assign(Object.assign({}, calendarContext), initialState);\n        for (let reducer of optionsData.pluginHooks.reducers) {\n            Object.assign(initialState, reducer(null, null, contextAndState));\n        }\n        if (computeIsLoading(initialState, calendarContext)) {\n            this.emitter.trigger('loading', true); // NOT DRY\n        }\n        this.state = initialState;\n        this.updateData();\n        this.actionRunner.resume();\n    }\n    resetOptions(optionOverrides, changedOptionNames) {\n        let { props } = this;\n        if (changedOptionNames === undefined) {\n            props.optionOverrides = optionOverrides;\n        }\n        else {\n            props.optionOverrides = Object.assign(Object.assign({}, (props.optionOverrides || {})), optionOverrides);\n            this.optionsForRefining.push(...changedOptionNames);\n        }\n        if (changedOptionNames === undefined || changedOptionNames.length) {\n            this.actionRunner.request({\n                type: 'NOTHING',\n            });\n        }\n    }\n    _handleAction(action) {\n        let { props, state, emitter } = this;\n        let dynamicOptionOverrides = reduceDynamicOptionOverrides(state.dynamicOptionOverrides, action);\n        let optionsData = this.computeOptionsData(props.optionOverrides, dynamicOptionOverrides, props.calendarApi);\n        let currentViewType = reduceViewType(state.currentViewType, action);\n        let currentViewData = this.computeCurrentViewData(currentViewType, optionsData, props.optionOverrides, dynamicOptionOverrides);\n        // wire things up\n        // TODO: not DRY\n        props.calendarApi.currentDataManager = this;\n        emitter.setThisContext(props.calendarApi);\n        emitter.setOptions(currentViewData.options);\n        let calendarContext = {\n            dateEnv: optionsData.dateEnv,\n            options: optionsData.calendarOptions,\n            pluginHooks: optionsData.pluginHooks,\n            calendarApi: props.calendarApi,\n            dispatch: this.dispatch,\n            emitter,\n            getCurrentData: this.getCurrentData,\n        };\n        let { currentDate, dateProfile } = state;\n        if (this.data && this.data.dateProfileGenerator !== currentViewData.dateProfileGenerator) { // hack\n            dateProfile = currentViewData.dateProfileGenerator.build(currentDate);\n        }\n        currentDate = reduceCurrentDate(currentDate, action);\n        dateProfile = reduceDateProfile(dateProfile, action, currentDate, currentViewData.dateProfileGenerator);\n        if (action.type === 'PREV' || // TODO: move this logic into DateProfileGenerator\n            action.type === 'NEXT' || // \"\n            !rangeContainsMarker(dateProfile.currentRange, currentDate)) {\n            currentDate = dateProfile.currentRange.start;\n        }\n        let eventSources = reduceEventSources(state.eventSources, action, dateProfile, calendarContext);\n        let eventStore = reduceEventStore(state.eventStore, action, eventSources, dateProfile, calendarContext);\n        let isEventsLoading = computeEventSourcesLoading(eventSources); // BAD. also called in this func in computeIsLoading\n        let renderableEventStore = (isEventsLoading && !currentViewData.options.progressiveEventRendering) ?\n            (state.renderableEventStore || eventStore) : // try from previous state\n            eventStore;\n        let { eventUiSingleBase, selectionConfig } = this.buildViewUiProps(calendarContext); // will memoize obj\n        let eventUiBySource = this.buildEventUiBySource(eventSources);\n        let eventUiBases = this.buildEventUiBases(renderableEventStore.defs, eventUiSingleBase, eventUiBySource);\n        let newState = {\n            dynamicOptionOverrides,\n            currentViewType,\n            currentDate,\n            dateProfile,\n            eventSources,\n            eventStore,\n            renderableEventStore,\n            selectionConfig,\n            eventUiBases,\n            businessHours: this.parseContextBusinessHours(calendarContext),\n            dateSelection: reduceDateSelection(state.dateSelection, action),\n            eventSelection: reduceSelectedEvent(state.eventSelection, action),\n            eventDrag: reduceEventDrag(state.eventDrag, action),\n            eventResize: reduceEventResize(state.eventResize, action),\n        };\n        let contextAndState = Object.assign(Object.assign({}, calendarContext), newState);\n        for (let reducer of optionsData.pluginHooks.reducers) {\n            Object.assign(newState, reducer(state, action, contextAndState)); // give the OLD state, for old value\n        }\n        let wasLoading = computeIsLoading(state, calendarContext);\n        let isLoading = computeIsLoading(newState, calendarContext);\n        // TODO: use propSetHandlers in plugin system\n        if (!wasLoading && isLoading) {\n            emitter.trigger('loading', true);\n        }\n        else if (wasLoading && !isLoading) {\n            emitter.trigger('loading', false);\n        }\n        this.state = newState;\n        if (props.onAction) {\n            props.onAction(action);\n        }\n    }\n    updateData() {\n        let { props, state } = this;\n        let oldData = this.data;\n        let optionsData = this.computeOptionsData(props.optionOverrides, state.dynamicOptionOverrides, props.calendarApi);\n        let currentViewData = this.computeCurrentViewData(state.currentViewType, optionsData, props.optionOverrides, state.dynamicOptionOverrides);\n        let data = this.data = Object.assign(Object.assign(Object.assign({ viewTitle: this.buildTitle(state.dateProfile, currentViewData.options, optionsData.dateEnv), calendarApi: props.calendarApi, dispatch: this.dispatch, emitter: this.emitter, getCurrentData: this.getCurrentData }, optionsData), currentViewData), state);\n        let changeHandlers = optionsData.pluginHooks.optionChangeHandlers;\n        let oldCalendarOptions = oldData && oldData.calendarOptions;\n        let newCalendarOptions = optionsData.calendarOptions;\n        if (oldCalendarOptions && oldCalendarOptions !== newCalendarOptions) {\n            if (oldCalendarOptions.timeZone !== newCalendarOptions.timeZone) {\n                // hack\n                state.eventSources = data.eventSources = reduceEventSourcesNewTimeZone(data.eventSources, state.dateProfile, data);\n                state.eventStore = data.eventStore = rezoneEventStoreDates(data.eventStore, oldData.dateEnv, data.dateEnv);\n                state.renderableEventStore = data.renderableEventStore = rezoneEventStoreDates(data.renderableEventStore, oldData.dateEnv, data.dateEnv);\n            }\n            for (let optionName in changeHandlers) {\n                if (this.optionsForHandling.indexOf(optionName) !== -1 ||\n                    oldCalendarOptions[optionName] !== newCalendarOptions[optionName]) {\n                    changeHandlers[optionName](newCalendarOptions[optionName], data);\n                }\n            }\n        }\n        this.optionsForHandling = [];\n        if (props.onData) {\n            props.onData(data);\n        }\n    }\n    computeOptionsData(optionOverrides, dynamicOptionOverrides, calendarApi) {\n        // TODO: blacklist options that are handled by optionChangeHandlers\n        if (!this.optionsForRefining.length &&\n            optionOverrides === this.stableOptionOverrides &&\n            dynamicOptionOverrides === this.stableDynamicOptionOverrides) {\n            return this.stableCalendarOptionsData;\n        }\n        let { refinedOptions, pluginHooks, localeDefaults, availableLocaleData, extra, } = this.processRawCalendarOptions(optionOverrides, dynamicOptionOverrides);\n        warnUnknownOptions(extra);\n        let dateEnv = this.buildDateEnv(refinedOptions.timeZone, refinedOptions.locale, refinedOptions.weekNumberCalculation, refinedOptions.firstDay, refinedOptions.weekText, pluginHooks, availableLocaleData, refinedOptions.defaultRangeSeparator);\n        let viewSpecs = this.buildViewSpecs(pluginHooks.views, this.stableOptionOverrides, this.stableDynamicOptionOverrides, localeDefaults);\n        let theme = this.buildTheme(refinedOptions, pluginHooks);\n        let toolbarConfig = this.parseToolbars(refinedOptions, this.stableOptionOverrides, theme, viewSpecs, calendarApi);\n        return this.stableCalendarOptionsData = {\n            calendarOptions: refinedOptions,\n            pluginHooks,\n            dateEnv,\n            viewSpecs,\n            theme,\n            toolbarConfig,\n            localeDefaults,\n            availableRawLocales: availableLocaleData.map,\n        };\n    }\n    // always called from behind a memoizer\n    processRawCalendarOptions(optionOverrides, dynamicOptionOverrides) {\n        let { locales, locale } = mergeRawOptions([\n            BASE_OPTION_DEFAULTS,\n            optionOverrides,\n            dynamicOptionOverrides,\n        ]);\n        let availableLocaleData = this.organizeRawLocales(locales);\n        let availableRawLocales = availableLocaleData.map;\n        let localeDefaults = this.buildLocale(locale || availableLocaleData.defaultCode, availableRawLocales).options;\n        let pluginHooks = this.buildPluginHooks(optionOverrides.plugins || [], globalPlugins);\n        let refiners = this.currentCalendarOptionsRefiners = Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({}, BASE_OPTION_REFINERS), CALENDAR_LISTENER_REFINERS), CALENDAR_OPTION_REFINERS), pluginHooks.listenerRefiners), pluginHooks.optionRefiners);\n        let extra = {};\n        let raw = mergeRawOptions([\n            BASE_OPTION_DEFAULTS,\n            localeDefaults,\n            optionOverrides,\n            dynamicOptionOverrides,\n        ]);\n        let refined = {};\n        let currentRaw = this.currentCalendarOptionsInput;\n        let currentRefined = this.currentCalendarOptionsRefined;\n        let anyChanges = false;\n        for (let optionName in raw) {\n            if (this.optionsForRefining.indexOf(optionName) === -1 && (raw[optionName] === currentRaw[optionName] || (COMPLEX_OPTION_COMPARATORS[optionName] &&\n                (optionName in currentRaw) &&\n                COMPLEX_OPTION_COMPARATORS[optionName](currentRaw[optionName], raw[optionName])))) {\n                refined[optionName] = currentRefined[optionName];\n            }\n            else if (refiners[optionName]) {\n                refined[optionName] = refiners[optionName](raw[optionName]);\n                anyChanges = true;\n            }\n            else {\n                extra[optionName] = currentRaw[optionName];\n            }\n        }\n        if (anyChanges) {\n            this.currentCalendarOptionsInput = raw;\n            this.currentCalendarOptionsRefined = refined;\n            this.stableOptionOverrides = optionOverrides;\n            this.stableDynamicOptionOverrides = dynamicOptionOverrides;\n        }\n        this.optionsForHandling.push(...this.optionsForRefining);\n        this.optionsForRefining = [];\n        return {\n            rawOptions: this.currentCalendarOptionsInput,\n            refinedOptions: this.currentCalendarOptionsRefined,\n            pluginHooks,\n            availableLocaleData,\n            localeDefaults,\n            extra,\n        };\n    }\n    _computeCurrentViewData(viewType, optionsData, optionOverrides, dynamicOptionOverrides) {\n        let viewSpec = optionsData.viewSpecs[viewType];\n        if (!viewSpec) {\n            throw new Error(`viewType \"${viewType}\" is not available. Please make sure you've loaded all neccessary plugins`);\n        }\n        let { refinedOptions, extra } = this.processRawViewOptions(viewSpec, optionsData.pluginHooks, optionsData.localeDefaults, optionOverrides, dynamicOptionOverrides);\n        warnUnknownOptions(extra);\n        let dateProfileGenerator = this.buildDateProfileGenerator({\n            dateProfileGeneratorClass: viewSpec.optionDefaults.dateProfileGeneratorClass,\n            duration: viewSpec.duration,\n            durationUnit: viewSpec.durationUnit,\n            usesMinMaxTime: viewSpec.optionDefaults.usesMinMaxTime,\n            dateEnv: optionsData.dateEnv,\n            calendarApi: this.props.calendarApi,\n            slotMinTime: refinedOptions.slotMinTime,\n            slotMaxTime: refinedOptions.slotMaxTime,\n            showNonCurrentDates: refinedOptions.showNonCurrentDates,\n            dayCount: refinedOptions.dayCount,\n            dateAlignment: refinedOptions.dateAlignment,\n            dateIncrement: refinedOptions.dateIncrement,\n            hiddenDays: refinedOptions.hiddenDays,\n            weekends: refinedOptions.weekends,\n            nowInput: refinedOptions.now,\n            validRangeInput: refinedOptions.validRange,\n            visibleRangeInput: refinedOptions.visibleRange,\n            fixedWeekCount: refinedOptions.fixedWeekCount,\n        });\n        let viewApi = this.buildViewApi(viewType, this.getCurrentData, optionsData.dateEnv);\n        return { viewSpec, options: refinedOptions, dateProfileGenerator, viewApi };\n    }\n    processRawViewOptions(viewSpec, pluginHooks, localeDefaults, optionOverrides, dynamicOptionOverrides) {\n        let raw = mergeRawOptions([\n            BASE_OPTION_DEFAULTS,\n            viewSpec.optionDefaults,\n            localeDefaults,\n            optionOverrides,\n            viewSpec.optionOverrides,\n            dynamicOptionOverrides,\n        ]);\n        let refiners = Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({}, BASE_OPTION_REFINERS), CALENDAR_LISTENER_REFINERS), CALENDAR_OPTION_REFINERS), VIEW_OPTION_REFINERS), pluginHooks.listenerRefiners), pluginHooks.optionRefiners);\n        let refined = {};\n        let currentRaw = this.currentViewOptionsInput;\n        let currentRefined = this.currentViewOptionsRefined;\n        let anyChanges = false;\n        let extra = {};\n        for (let optionName in raw) {\n            if (raw[optionName] === currentRaw[optionName] ||\n                (COMPLEX_OPTION_COMPARATORS[optionName] &&\n                    COMPLEX_OPTION_COMPARATORS[optionName](raw[optionName], currentRaw[optionName]))) {\n                refined[optionName] = currentRefined[optionName];\n            }\n            else {\n                if (raw[optionName] === this.currentCalendarOptionsInput[optionName] ||\n                    (COMPLEX_OPTION_COMPARATORS[optionName] &&\n                        COMPLEX_OPTION_COMPARATORS[optionName](raw[optionName], this.currentCalendarOptionsInput[optionName]))) {\n                    if (optionName in this.currentCalendarOptionsRefined) { // might be an \"extra\" prop\n                        refined[optionName] = this.currentCalendarOptionsRefined[optionName];\n                    }\n                }\n                else if (refiners[optionName]) {\n                    refined[optionName] = refiners[optionName](raw[optionName]);\n                }\n                else {\n                    extra[optionName] = raw[optionName];\n                }\n                anyChanges = true;\n            }\n        }\n        if (anyChanges) {\n            this.currentViewOptionsInput = raw;\n            this.currentViewOptionsRefined = refined;\n        }\n        return {\n            rawOptions: this.currentViewOptionsInput,\n            refinedOptions: this.currentViewOptionsRefined,\n            extra,\n        };\n    }\n}\nfunction buildDateEnv$1(timeZone, explicitLocale, weekNumberCalculation, firstDay, weekText, pluginHooks, availableLocaleData, defaultSeparator) {\n    let locale = buildLocale(explicitLocale || availableLocaleData.defaultCode, availableLocaleData.map);\n    return new DateEnv({\n        calendarSystem: 'gregory',\n        timeZone,\n        namedTimeZoneImpl: pluginHooks.namedTimeZonedImpl,\n        locale,\n        weekNumberCalculation,\n        firstDay,\n        weekText,\n        cmdFormatter: pluginHooks.cmdFormatter,\n        defaultSeparator,\n    });\n}\nfunction buildTheme(options, pluginHooks) {\n    let ThemeClass = pluginHooks.themeClasses[options.themeSystem] || StandardTheme;\n    return new ThemeClass(options);\n}\nfunction buildDateProfileGenerator(props) {\n    let DateProfileGeneratorClass = props.dateProfileGeneratorClass || DateProfileGenerator;\n    return new DateProfileGeneratorClass(props);\n}\nfunction buildViewApi(type, getCurrentData, dateEnv) {\n    return new ViewImpl(type, getCurrentData, dateEnv);\n}\nfunction buildEventUiBySource(eventSources) {\n    return mapHash(eventSources, (eventSource) => eventSource.ui);\n}\nfunction buildEventUiBases(eventDefs, eventUiSingleBase, eventUiBySource) {\n    let eventUiBases = { '': eventUiSingleBase };\n    for (let defId in eventDefs) {\n        let def = eventDefs[defId];\n        if (def.sourceId && eventUiBySource[def.sourceId]) {\n            eventUiBases[defId] = eventUiBySource[def.sourceId];\n        }\n    }\n    return eventUiBases;\n}\nfunction buildViewUiProps(calendarContext) {\n    let { options } = calendarContext;\n    return {\n        eventUiSingleBase: createEventUi({\n            display: options.eventDisplay,\n            editable: options.editable,\n            startEditable: options.eventStartEditable,\n            durationEditable: options.eventDurationEditable,\n            constraint: options.eventConstraint,\n            overlap: typeof options.eventOverlap === 'boolean' ? options.eventOverlap : undefined,\n            allow: options.eventAllow,\n            backgroundColor: options.eventBackgroundColor,\n            borderColor: options.eventBorderColor,\n            textColor: options.eventTextColor,\n            color: options.eventColor,\n            // classNames: options.eventClassNames // render hook will handle this\n        }, calendarContext),\n        selectionConfig: createEventUi({\n            constraint: options.selectConstraint,\n            overlap: typeof options.selectOverlap === 'boolean' ? options.selectOverlap : undefined,\n            allow: options.selectAllow,\n        }, calendarContext),\n    };\n}\nfunction computeIsLoading(state, context) {\n    for (let isLoadingFunc of context.pluginHooks.isLoadingFuncs) {\n        if (isLoadingFunc(state)) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction parseContextBusinessHours(calendarContext) {\n    return parseBusinessHours(calendarContext.options.businessHours, calendarContext);\n}\nfunction warnUnknownOptions(options, viewName) {\n    for (let optionName in options) {\n        console.warn(`Unknown option '${optionName}'` +\n            (viewName ? ` for view '${viewName}'` : ''));\n    }\n}\n\nclass ToolbarSection extends BaseComponent {\n    render() {\n        let children = this.props.widgetGroups.map((widgetGroup) => this.renderWidgetGroup(widgetGroup));\n        return createElement('div', { className: 'fc-toolbar-chunk' }, ...children);\n    }\n    renderWidgetGroup(widgetGroup) {\n        let { props } = this;\n        let { theme } = this.context;\n        let children = [];\n        let isOnlyButtons = true;\n        for (let widget of widgetGroup) {\n            let { buttonName, buttonClick, buttonText, buttonIcon, buttonHint } = widget;\n            if (buttonName === 'title') {\n                isOnlyButtons = false;\n                children.push(createElement(\"h2\", { className: \"fc-toolbar-title\", id: props.titleId }, props.title));\n            }\n            else {\n                let isPressed = buttonName === props.activeButton;\n                let isDisabled = (!props.isTodayEnabled && buttonName === 'today') ||\n                    (!props.isPrevEnabled && buttonName === 'prev') ||\n                    (!props.isNextEnabled && buttonName === 'next');\n                let buttonClasses = [`fc-${buttonName}-button`, theme.getClass('button')];\n                if (isPressed) {\n                    buttonClasses.push(theme.getClass('buttonActive'));\n                }\n                children.push(createElement(\"button\", { type: \"button\", title: typeof buttonHint === 'function' ? buttonHint(props.navUnit) : buttonHint, disabled: isDisabled, \"aria-pressed\": isPressed, className: buttonClasses.join(' '), onClick: buttonClick }, buttonText || (buttonIcon ? createElement(\"span\", { className: buttonIcon, role: \"img\" }) : '')));\n            }\n        }\n        if (children.length > 1) {\n            let groupClassName = (isOnlyButtons && theme.getClass('buttonGroup')) || '';\n            return createElement('div', { className: groupClassName }, ...children);\n        }\n        return children[0];\n    }\n}\n\nclass Toolbar extends BaseComponent {\n    render() {\n        let { model, extraClassName } = this.props;\n        let forceLtr = false;\n        let startContent;\n        let endContent;\n        let sectionWidgets = model.sectionWidgets;\n        let centerContent = sectionWidgets.center;\n        if (sectionWidgets.left) {\n            forceLtr = true;\n            startContent = sectionWidgets.left;\n        }\n        else {\n            startContent = sectionWidgets.start;\n        }\n        if (sectionWidgets.right) {\n            forceLtr = true;\n            endContent = sectionWidgets.right;\n        }\n        else {\n            endContent = sectionWidgets.end;\n        }\n        let classNames = [\n            extraClassName || '',\n            'fc-toolbar',\n            forceLtr ? 'fc-toolbar-ltr' : '',\n        ];\n        return (createElement(\"div\", { className: classNames.join(' ') },\n            this.renderSection('start', startContent || []),\n            this.renderSection('center', centerContent || []),\n            this.renderSection('end', endContent || [])));\n    }\n    renderSection(key, widgetGroups) {\n        let { props } = this;\n        return (createElement(ToolbarSection, { key: key, widgetGroups: widgetGroups, title: props.title, navUnit: props.navUnit, activeButton: props.activeButton, isTodayEnabled: props.isTodayEnabled, isPrevEnabled: props.isPrevEnabled, isNextEnabled: props.isNextEnabled, titleId: props.titleId }));\n    }\n}\n\nclass ViewHarness extends BaseComponent {\n    constructor() {\n        super(...arguments);\n        this.state = {\n            availableWidth: null,\n        };\n        this.handleEl = (el) => {\n            this.el = el;\n            setRef(this.props.elRef, el);\n            this.updateAvailableWidth();\n        };\n        this.handleResize = () => {\n            this.updateAvailableWidth();\n        };\n    }\n    render() {\n        let { props, state } = this;\n        let { aspectRatio } = props;\n        let classNames = [\n            'fc-view-harness',\n            (aspectRatio || props.liquid || props.height)\n                ? 'fc-view-harness-active' // harness controls the height\n                : 'fc-view-harness-passive', // let the view do the height\n        ];\n        let height = '';\n        let paddingBottom = '';\n        if (aspectRatio) {\n            if (state.availableWidth !== null) {\n                height = state.availableWidth / aspectRatio;\n            }\n            else {\n                // while waiting to know availableWidth, we can't set height to *zero*\n                // because will cause lots of unnecessary scrollbars within scrollgrid.\n                // BETTER: don't start rendering ANYTHING yet until we know container width\n                // NOTE: why not always use paddingBottom? Causes height oscillation (issue 5606)\n                paddingBottom = `${(1 / aspectRatio) * 100}%`;\n            }\n        }\n        else {\n            height = props.height || '';\n        }\n        return (createElement(\"div\", { \"aria-labelledby\": props.labeledById, ref: this.handleEl, className: classNames.join(' '), style: { height, paddingBottom } }, props.children));\n    }\n    componentDidMount() {\n        this.context.addResizeHandler(this.handleResize);\n    }\n    componentWillUnmount() {\n        this.context.removeResizeHandler(this.handleResize);\n    }\n    updateAvailableWidth() {\n        if (this.el && // needed. but why?\n            this.props.aspectRatio // aspectRatio is the only height setting that needs availableWidth\n        ) {\n            this.setState({ availableWidth: this.el.offsetWidth });\n        }\n    }\n}\n\n/*\nDetects when the user clicks on an event within a DateComponent\n*/\nclass EventClicking extends Interaction {\n    constructor(settings) {\n        super(settings);\n        this.handleSegClick = (ev, segEl) => {\n            let { component } = this;\n            let { context } = component;\n            let seg = getElSeg(segEl);\n            if (seg && // might be the <div> surrounding the more link\n                component.isValidSegDownEl(ev.target)) {\n                // our way to simulate a link click for elements that can't be <a> tags\n                // grab before trigger fired in case trigger trashes DOM thru rerendering\n                let hasUrlContainer = elementClosest(ev.target, '.fc-event-forced-url');\n                let url = hasUrlContainer ? hasUrlContainer.querySelector('a[href]').href : '';\n                context.emitter.trigger('eventClick', {\n                    el: segEl,\n                    event: new EventImpl(component.context, seg.eventRange.def, seg.eventRange.instance),\n                    jsEvent: ev,\n                    view: context.viewApi,\n                });\n                if (url && !ev.defaultPrevented) {\n                    window.location.href = url;\n                }\n            }\n        };\n        this.destroy = listenBySelector(settings.el, 'click', '.fc-event', // on both fg and bg events\n        this.handleSegClick);\n    }\n}\n\n/*\nTriggers events and adds/removes core classNames when the user's pointer\nenters/leaves event-elements of a component.\n*/\nclass EventHovering extends Interaction {\n    constructor(settings) {\n        super(settings);\n        // for simulating an eventMouseLeave when the event el is destroyed while mouse is over it\n        this.handleEventElRemove = (el) => {\n            if (el === this.currentSegEl) {\n                this.handleSegLeave(null, this.currentSegEl);\n            }\n        };\n        this.handleSegEnter = (ev, segEl) => {\n            if (getElSeg(segEl)) { // TODO: better way to make sure not hovering over more+ link or its wrapper\n                this.currentSegEl = segEl;\n                this.triggerEvent('eventMouseEnter', ev, segEl);\n            }\n        };\n        this.handleSegLeave = (ev, segEl) => {\n            if (this.currentSegEl) {\n                this.currentSegEl = null;\n                this.triggerEvent('eventMouseLeave', ev, segEl);\n            }\n        };\n        this.removeHoverListeners = listenToHoverBySelector(settings.el, '.fc-event', // on both fg and bg events\n        this.handleSegEnter, this.handleSegLeave);\n    }\n    destroy() {\n        this.removeHoverListeners();\n    }\n    triggerEvent(publicEvName, ev, segEl) {\n        let { component } = this;\n        let { context } = component;\n        let seg = getElSeg(segEl);\n        if (!ev || component.isValidSegDownEl(ev.target)) {\n            context.emitter.trigger(publicEvName, {\n                el: segEl,\n                event: new EventImpl(context, seg.eventRange.def, seg.eventRange.instance),\n                jsEvent: ev,\n                view: context.viewApi,\n            });\n        }\n    }\n}\n\nclass CalendarContent extends PureComponent {\n    constructor() {\n        super(...arguments);\n        this.buildViewContext = memoize(buildViewContext);\n        this.buildViewPropTransformers = memoize(buildViewPropTransformers);\n        this.buildToolbarProps = memoize(buildToolbarProps);\n        this.headerRef = createRef();\n        this.footerRef = createRef();\n        this.interactionsStore = {};\n        // eslint-disable-next-line\n        this.state = {\n            viewLabelId: getUniqueDomId(),\n        };\n        // Component Registration\n        // -----------------------------------------------------------------------------------------------------------------\n        this.registerInteractiveComponent = (component, settingsInput) => {\n            let settings = parseInteractionSettings(component, settingsInput);\n            let DEFAULT_INTERACTIONS = [\n                EventClicking,\n                EventHovering,\n            ];\n            let interactionClasses = DEFAULT_INTERACTIONS.concat(this.props.pluginHooks.componentInteractions);\n            let interactions = interactionClasses.map((TheInteractionClass) => new TheInteractionClass(settings));\n            this.interactionsStore[component.uid] = interactions;\n            interactionSettingsStore[component.uid] = settings;\n        };\n        this.unregisterInteractiveComponent = (component) => {\n            let listeners = this.interactionsStore[component.uid];\n            if (listeners) {\n                for (let listener of listeners) {\n                    listener.destroy();\n                }\n                delete this.interactionsStore[component.uid];\n            }\n            delete interactionSettingsStore[component.uid];\n        };\n        // Resizing\n        // -----------------------------------------------------------------------------------------------------------------\n        this.resizeRunner = new DelayedRunner(() => {\n            this.props.emitter.trigger('_resize', true); // should window resizes be considered \"forced\" ?\n            this.props.emitter.trigger('windowResize', { view: this.props.viewApi });\n        });\n        this.handleWindowResize = (ev) => {\n            let { options } = this.props;\n            if (options.handleWindowResize &&\n                ev.target === window // avoid jqui events\n            ) {\n                this.resizeRunner.request(options.windowResizeDelay);\n            }\n        };\n    }\n    /*\n    renders INSIDE of an outer div\n    */\n    render() {\n        let { props } = this;\n        let { toolbarConfig, options } = props;\n        let toolbarProps = this.buildToolbarProps(props.viewSpec, props.dateProfile, props.dateProfileGenerator, props.currentDate, getNow(props.options.now, props.dateEnv), // TODO: use NowTimer????\n        props.viewTitle);\n        let viewVGrow = false;\n        let viewHeight = '';\n        let viewAspectRatio;\n        if (props.isHeightAuto || props.forPrint) {\n            viewHeight = '';\n        }\n        else if (options.height != null) {\n            viewVGrow = true;\n        }\n        else if (options.contentHeight != null) {\n            viewHeight = options.contentHeight;\n        }\n        else {\n            viewAspectRatio = Math.max(options.aspectRatio, 0.5); // prevent from getting too tall\n        }\n        let viewContext = this.buildViewContext(props.viewSpec, props.viewApi, props.options, props.dateProfileGenerator, props.dateEnv, props.theme, props.pluginHooks, props.dispatch, props.getCurrentData, props.emitter, props.calendarApi, this.registerInteractiveComponent, this.unregisterInteractiveComponent);\n        let viewLabelId = (toolbarConfig.header && toolbarConfig.header.hasTitle)\n            ? this.state.viewLabelId\n            : undefined;\n        return (createElement(ViewContextType.Provider, { value: viewContext },\n            toolbarConfig.header && (createElement(Toolbar, Object.assign({ ref: this.headerRef, extraClassName: \"fc-header-toolbar\", model: toolbarConfig.header, titleId: viewLabelId }, toolbarProps))),\n            createElement(ViewHarness, { liquid: viewVGrow, height: viewHeight, aspectRatio: viewAspectRatio, labeledById: viewLabelId },\n                this.renderView(props),\n                this.buildAppendContent()),\n            toolbarConfig.footer && (createElement(Toolbar, Object.assign({ ref: this.footerRef, extraClassName: \"fc-footer-toolbar\", model: toolbarConfig.footer, titleId: \"\" }, toolbarProps)))));\n    }\n    componentDidMount() {\n        let { props } = this;\n        this.calendarInteractions = props.pluginHooks.calendarInteractions\n            .map((CalendarInteractionClass) => new CalendarInteractionClass(props));\n        window.addEventListener('resize', this.handleWindowResize);\n        let { propSetHandlers } = props.pluginHooks;\n        for (let propName in propSetHandlers) {\n            propSetHandlers[propName](props[propName], props);\n        }\n    }\n    componentDidUpdate(prevProps) {\n        let { props } = this;\n        let { propSetHandlers } = props.pluginHooks;\n        for (let propName in propSetHandlers) {\n            if (props[propName] !== prevProps[propName]) {\n                propSetHandlers[propName](props[propName], props);\n            }\n        }\n    }\n    componentWillUnmount() {\n        window.removeEventListener('resize', this.handleWindowResize);\n        this.resizeRunner.clear();\n        for (let interaction of this.calendarInteractions) {\n            interaction.destroy();\n        }\n        this.props.emitter.trigger('_unmount');\n    }\n    buildAppendContent() {\n        let { props } = this;\n        let children = props.pluginHooks.viewContainerAppends.map((buildAppendContent) => buildAppendContent(props));\n        return createElement(Fragment, {}, ...children);\n    }\n    renderView(props) {\n        let { pluginHooks } = props;\n        let { viewSpec } = props;\n        let viewProps = {\n            dateProfile: props.dateProfile,\n            businessHours: props.businessHours,\n            eventStore: props.renderableEventStore,\n            eventUiBases: props.eventUiBases,\n            dateSelection: props.dateSelection,\n            eventSelection: props.eventSelection,\n            eventDrag: props.eventDrag,\n            eventResize: props.eventResize,\n            isHeightAuto: props.isHeightAuto,\n            forPrint: props.forPrint,\n        };\n        let transformers = this.buildViewPropTransformers(pluginHooks.viewPropsTransformers);\n        for (let transformer of transformers) {\n            Object.assign(viewProps, transformer.transform(viewProps, props));\n        }\n        let ViewComponent = viewSpec.component;\n        return (createElement(ViewComponent, Object.assign({}, viewProps)));\n    }\n}\nfunction buildToolbarProps(viewSpec, dateProfile, dateProfileGenerator, currentDate, now, title) {\n    // don't force any date-profiles to valid date profiles (the `false`) so that we can tell if it's invalid\n    let todayInfo = dateProfileGenerator.build(now, undefined, false); // TODO: need `undefined` or else INFINITE LOOP for some reason\n    let prevInfo = dateProfileGenerator.buildPrev(dateProfile, currentDate, false);\n    let nextInfo = dateProfileGenerator.buildNext(dateProfile, currentDate, false);\n    return {\n        title,\n        activeButton: viewSpec.type,\n        navUnit: viewSpec.singleUnit,\n        isTodayEnabled: todayInfo.isValid && !rangeContainsMarker(dateProfile.currentRange, now),\n        isPrevEnabled: prevInfo.isValid,\n        isNextEnabled: nextInfo.isValid,\n    };\n}\n// Plugin\n// -----------------------------------------------------------------------------------------------------------------\nfunction buildViewPropTransformers(theClasses) {\n    return theClasses.map((TheClass) => new TheClass());\n}\n\nclass Calendar extends CalendarImpl {\n    constructor(el, optionOverrides = {}) {\n        super();\n        this.isRendering = false;\n        this.isRendered = false;\n        this.currentClassNames = [];\n        this.customContentRenderId = 0;\n        this.handleAction = (action) => {\n            // actions we know we want to render immediately\n            switch (action.type) {\n                case 'SET_EVENT_DRAG':\n                case 'SET_EVENT_RESIZE':\n                    this.renderRunner.tryDrain();\n            }\n        };\n        this.handleData = (data) => {\n            this.currentData = data;\n            this.renderRunner.request(data.calendarOptions.rerenderDelay);\n        };\n        this.handleRenderRequest = () => {\n            if (this.isRendering) {\n                this.isRendered = true;\n                let { currentData } = this;\n                flushSync(() => {\n                    render(createElement(CalendarRoot, { options: currentData.calendarOptions, theme: currentData.theme, emitter: currentData.emitter }, (classNames, height, isHeightAuto, forPrint) => {\n                        this.setClassNames(classNames);\n                        this.setHeight(height);\n                        return (createElement(RenderId.Provider, { value: this.customContentRenderId },\n                            createElement(CalendarContent, Object.assign({ isHeightAuto: isHeightAuto, forPrint: forPrint }, currentData))));\n                    }), this.el);\n                });\n            }\n            else if (this.isRendered) {\n                this.isRendered = false;\n                render(null, this.el);\n                this.setClassNames([]);\n                this.setHeight('');\n            }\n        };\n        ensureElHasStyles(el);\n        this.el = el;\n        this.renderRunner = new DelayedRunner(this.handleRenderRequest);\n        new CalendarDataManager({\n            optionOverrides,\n            calendarApi: this,\n            onAction: this.handleAction,\n            onData: this.handleData,\n        });\n    }\n    render() {\n        let wasRendering = this.isRendering;\n        if (!wasRendering) {\n            this.isRendering = true;\n        }\n        else {\n            this.customContentRenderId += 1;\n        }\n        this.renderRunner.request();\n        if (wasRendering) {\n            this.updateSize();\n        }\n    }\n    destroy() {\n        if (this.isRendering) {\n            this.isRendering = false;\n            this.renderRunner.request();\n        }\n    }\n    updateSize() {\n        flushSync(() => {\n            super.updateSize();\n        });\n    }\n    batchRendering(func) {\n        this.renderRunner.pause('batchRendering');\n        func();\n        this.renderRunner.resume('batchRendering');\n    }\n    pauseRendering() {\n        this.renderRunner.pause('pauseRendering');\n    }\n    resumeRendering() {\n        this.renderRunner.resume('pauseRendering', true);\n    }\n    resetOptions(optionOverrides, changedOptionNames) {\n        this.currentDataManager.resetOptions(optionOverrides, changedOptionNames);\n    }\n    setClassNames(classNames) {\n        if (!isArraysEqual(classNames, this.currentClassNames)) {\n            let { classList } = this.el;\n            for (let className of this.currentClassNames) {\n                classList.remove(className);\n            }\n            for (let className of classNames) {\n                classList.add(className);\n            }\n            this.currentClassNames = classNames;\n        }\n    }\n    setHeight(height) {\n        applyStyleProp(this.el, 'height', height);\n    }\n}\n\nfunction formatDate(dateInput, options = {}) {\n    let dateEnv = buildDateEnv(options);\n    let formatter = createFormatter(options);\n    let dateMeta = dateEnv.createMarkerMeta(dateInput);\n    if (!dateMeta) { // TODO: warning?\n        return '';\n    }\n    return dateEnv.format(dateMeta.marker, formatter, {\n        forcedTzo: dateMeta.forcedTzo,\n    });\n}\nfunction formatRange(startInput, endInput, options) {\n    let dateEnv = buildDateEnv(typeof options === 'object' && options ? options : {}); // pass in if non-null object\n    let formatter = createFormatter(options);\n    let startMeta = dateEnv.createMarkerMeta(startInput);\n    let endMeta = dateEnv.createMarkerMeta(endInput);\n    if (!startMeta || !endMeta) { // TODO: warning?\n        return '';\n    }\n    return dateEnv.formatRange(startMeta.marker, endMeta.marker, formatter, {\n        forcedStartTzo: startMeta.forcedTzo,\n        forcedEndTzo: endMeta.forcedTzo,\n        isEndExclusive: options.isEndExclusive,\n        defaultSeparator: BASE_OPTION_DEFAULTS.defaultRangeSeparator,\n    });\n}\n// TODO: more DRY and optimized\nfunction buildDateEnv(settings) {\n    let locale = buildLocale(settings.locale || 'en', organizeRawLocales([]).map); // TODO: don't hardcode 'en' everywhere\n    return new DateEnv(Object.assign(Object.assign({ timeZone: BASE_OPTION_DEFAULTS.timeZone, calendarSystem: 'gregory' }, settings), { locale }));\n}\n\n// HELPERS\n/*\nif nextDayThreshold is specified, slicing is done in an all-day fashion.\nyou can get nextDayThreshold from context.nextDayThreshold\n*/\nfunction sliceEvents(props, allDay) {\n    return sliceEventStore(props.eventStore, props.eventUiBases, props.dateProfile.activeRange, allDay ? props.nextDayThreshold : null).fg;\n}\n\nconst version = '6.1.11';\n\nexport { Calendar, createPlugin, formatDate, formatRange, globalLocales, globalPlugins, sliceEvents, version };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}